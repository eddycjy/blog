---

title:      "æ·±å…¥ç†è§£ Go Slice"
date:       2018-12-11 12:00:00
author:     "ç…é±¼"
toc: true
tags:
    - go
    - æºç åˆ†æ
---

![image](https://s2.ax1x.com/2020/02/27/3dXSeA.png)

## æ˜¯ä»€ä¹ˆ

åœ¨ Go ä¸­ï¼ŒSliceï¼ˆåˆ‡ç‰‡ï¼‰æ˜¯æŠ½è±¡åœ¨ Arrayï¼ˆæ•°ç»„ï¼‰ä¹‹ä¸Šçš„ç‰¹æ®Šç±»å‹ã€‚ä¸ºäº†æ›´å¥½åœ°äº†è§£ Sliceï¼Œç¬¬ä¸€æ­¥éœ€è¦å…ˆå¯¹ Array è¿›è¡Œç†è§£ã€‚æ·±åˆ»äº†è§£ Slice ä¸ Array ä¹‹é—´çš„åŒºåˆ«åï¼Œå°±èƒ½æ›´å¥½çš„å¯¹å…¶åº•å±‚ä¸€ç•ªæ‘¸ç´¢ ğŸ˜„

## ç”¨æ³•

### Array

```go
func main() {
	nums := [3]int{}
	nums[0] = 1

	n := nums[0]
	n = 2

	fmt.Printf("nums: %v\n", nums)
	fmt.Printf("n: %d\n", n)
}
```

æˆ‘ä»¬å¯å¾—çŸ¥åœ¨ Go ä¸­ï¼Œæ•°ç»„ç±»å‹éœ€è¦æŒ‡å®šé•¿åº¦å’Œå…ƒç´ ç±»å‹ã€‚åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œå¯å¾—çŸ¥ `[3]int{}` è¡¨ç¤º 3 ä¸ªæ•´æ•°çš„æ•°ç»„ï¼Œå¹¶è¿›è¡Œäº†åˆå§‹åŒ–ã€‚åº•å±‚æ•°æ®å­˜å‚¨ä¸ºä¸€æ®µè¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œé€šè¿‡å›ºå®šçš„ç´¢å¼•å€¼ï¼ˆä¸‹æ ‡ï¼‰è¿›è¡Œæ£€ç´¢

![image](https://s2.ax1x.com/2020/02/27/3dXASS.png)

æ•°ç»„åœ¨å£°æ˜åï¼Œå…¶å…ƒç´ çš„åˆå§‹å€¼ï¼ˆä¹Ÿå°±æ˜¯é›¶å€¼ï¼‰ä¸º 0ã€‚å¹¶ä¸”è¯¥å˜é‡å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¸éœ€è¦ç‰¹æ®Šæ“ä½œ

åŒæ—¶æ•°ç»„çš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œå®ƒçš„é•¿åº¦æ˜¯ç±»å‹çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤ `[3]int` å’Œ `[4]int` åœ¨ç±»å‹ä¸Šæ˜¯ä¸åŒçš„ï¼Œä¸èƒ½ç§°ä¸º â€œä¸€ä¸ªä¸œè¥¿â€

#### è¾“å‡ºç»“æœ

```
nums: [1 0 0]
n: 2
```

### Slice

```go
func main() {
	nums := [3]int{}
	nums[0] = 1

	dnums := nums[:]

	fmt.Printf("dnums: %v", dnums)
}
```

Slice æ˜¯å¯¹ Array çš„æŠ½è±¡ï¼Œç±»å‹ä¸º `[]T`ã€‚åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ`dnums` å˜é‡é€šè¿‡ `nums[:]` è¿›è¡Œèµ‹å€¼ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒSlice å’Œ Array ä¸ä¸€æ ·ï¼Œå®ƒä¸éœ€è¦æŒ‡å®šé•¿åº¦ã€‚ä¹Ÿæ›´åŠ çš„çµæ´»ï¼Œèƒ½å¤Ÿè‡ªåŠ¨æ‰©å®¹

## æ•°æ®ç»“æ„

![image](https://s2.ax1x.com/2020/02/27/3wmr3F.png)

```go
type slice struct {
	array unsafe.Pointer
	len   int
	cap   int
}
```

Slice çš„åº•å±‚æ•°æ®ç»“æ„å…±åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼Œå¦‚ä¸‹ï¼š

- arrayï¼šæŒ‡å‘æ‰€å¼•ç”¨çš„æ•°ç»„æŒ‡é’ˆï¼ˆ`unsafe.Pointer` å¯ä»¥è¡¨ç¤ºä»»ä½•å¯å¯»å€çš„å€¼çš„æŒ‡é’ˆï¼‰
- lenï¼šé•¿åº¦ï¼Œå½“å‰å¼•ç”¨åˆ‡ç‰‡çš„å…ƒç´ ä¸ªæ•°
- capï¼šå®¹é‡ï¼Œå½“å‰å¼•ç”¨åˆ‡ç‰‡çš„å®¹é‡ï¼ˆåº•å±‚æ•°ç»„çš„å…ƒç´ æ€»æ•°ï¼‰

åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œcap ä¸€å®šæ˜¯å¤§äºæˆ–ç­‰äº len çš„ã€‚å¦åˆ™ä¼šå¯¼è‡´ panic

### ç¤ºä¾‹

ä¸ºäº†æ›´å¥½çš„ç†è§£ï¼Œæˆ‘ä»¬å›é¡¾ä¸Šå°èŠ‚çš„ä»£ç ä¾¿äºæ¼”ç¤ºï¼Œå¦‚ä¸‹ï¼š

```go
func main() {
	nums := [3]int{}
	nums[0] = 1

	dnums := nums[:]

	fmt.Printf("dnums: %v", dnums)
}
```

![image](https://s2.ax1x.com/2020/02/27/3wmoge.png)

åœ¨ä»£ç ä¸­ï¼Œå¯è§‚å¯Ÿåˆ° `dnums := nums[:]`ï¼Œè¿™æ®µä»£ç ç¡®å®šäº† Slice çš„ Pointer æŒ‡å‘æ•°ç»„ï¼Œä¸” len å’Œ cap éƒ½ä¸ºæ•°ç»„çš„åŸºç¡€å±æ€§ã€‚ä¸å›¾ç¤ºè¡¨è¾¾ä¸€è‡´

### lenã€cap ä¸åŒ

```go
func main() {
	nums := [3]int{}
	nums[0] = 1

	dnums := nums[0:2]

	fmt.Printf("dnums: %v, len: %d, cap: %d", dnums, len(dnums), cap(dnums))
}
```

![image](https://s2.ax1x.com/2020/02/27/3wmxC8.png)

#### è¾“å‡ºç»“æœ

```
dnums: [1 0], len: 2, cap: 3
```

æ˜¾ç„¶ï¼Œåœ¨è¿™é‡ŒæŒ‡å®šäº† `Slice[0:2]`ï¼Œå› æ­¤ len ä¸ºæ‰€å¼•ç”¨å…ƒç´ çš„ä¸ªæ•°ï¼Œcap ä¸ºæ‰€å¼•ç”¨çš„æ•°ç»„å…ƒç´ æ€»ä¸ªæ•°ã€‚ä¸æœŸå¾…ä¸€è‡´ ğŸ˜„

## åˆ›å»º

Slice çš„åˆ›å»ºæœ‰ä¸¤ç§æ–¹å¼ï¼Œå¦‚ä¸‹ï¼š

- `var []T` æˆ– `[]T{}`
- `func makeï¼ˆ[] Tï¼Œlenï¼Œcapï¼‰[] T`

å¯ä»¥ç•™æ„ make å‡½æ•°ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ Slice éœ€è¦æŒ‡å‘ä¸€ä¸ª Arrayã€‚é‚£ make æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿ

å®ƒä¼šåœ¨è°ƒç”¨ make çš„æ—¶å€™ï¼Œåˆ†é…ä¸€ä¸ªæ•°ç»„å¹¶è¿”å›å¼•ç”¨è¯¥æ•°ç»„çš„ Slice

```go
func makeslice(et *_type, len, cap int) slice {
	maxElements := maxSliceCap(et.size)
	if len < 0 || uintptr(len) > maxElements {
		panic(errorString("makeslice: len out of range"))
	}

	if cap < len || uintptr(cap) > maxElements {
		panic(errorString("makeslice: cap out of range"))
	}

	p := mallocgc(et.size*uintptr(cap), et, true)
	return slice{p, len, cap}
}
```

- æ ¹æ®ä¼ å…¥çš„ Slice ç±»å‹ï¼Œè·å–å…¶ç±»å‹èƒ½å¤Ÿç”³è¯·çš„æœ€å¤§å®¹é‡å¤§å°
- åˆ¤æ–­ len æ˜¯å¦åˆè§„ï¼Œæ£€æŸ¥æ˜¯å¦åœ¨ 0 < x < maxElements èŒƒå›´å†…
- åˆ¤æ–­ cap æ˜¯å¦åˆè§„ï¼Œæ£€æŸ¥æ˜¯å¦åœ¨ len < x < maxElements èŒƒå›´å†…
- ç”³è¯· Slice æ‰€éœ€çš„å†…å­˜ç©ºé—´å¯¹è±¡ã€‚è‹¥ä¸ºå¤§å‹å¯¹è±¡ï¼ˆå¤§äº 32 KBï¼‰åˆ™ç›´æ¥ä»å †ä¸­åˆ†é…
- è¿”å›ç”³è¯·æˆåŠŸçš„ Slice å†…å­˜åœ°å€å’Œç›¸å…³å±æ€§ï¼ˆé»˜è®¤è¿”å›ç”³è¯·åˆ°çš„å†…å­˜èµ·å§‹åœ°å€ï¼‰

## æ‰©å®¹

å½“ä½¿ç”¨ Slice æ—¶ï¼Œè‹¥å­˜å‚¨çš„å…ƒç´ ä¸æ–­å¢é•¿ï¼ˆä¾‹å¦‚é€šè¿‡ appendï¼‰ã€‚å½“æ¡ä»¶æ»¡è¶³æ‰©å®¹çš„ç­–ç•¥æ—¶ï¼Œå°†ä¼šè§¦å‘è‡ªåŠ¨æ‰©å®¹

é‚£ä¹ˆåˆ†åˆ«æ˜¯ä»€ä¹ˆè§„åˆ™å‘¢ï¼Ÿè®©æˆ‘ä»¬ä¸€èµ·çœ‹çœ‹æºç æ˜¯æ€ä¹ˆè¯´çš„ ğŸ˜„

### zerobase

```go
func growslice(et *_type, old slice, cap int) slice {
	...
	if et.size == 0 {
		if cap < old.cap {
			panic(errorString("growslice: cap out of range"))
		}

		return slice{unsafe.Pointer(&zerobase), old.len, cap}
	}
    ...
}
```

å½“ Slice size ä¸º 0 æ—¶ï¼Œè‹¥å°†è¦æ‰©å®¹çš„å®¹é‡æ¯”åŸæœ¬çš„å®¹é‡å°ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ï¼ˆä¹Ÿå°±æ˜¯ä¸æ”¯æŒç¼©å®¹æ“ä½œï¼‰ã€‚å¦åˆ™ï¼Œå°†é‡æ–°ç”Ÿæˆä¸€ä¸ªæ–°çš„ Slice è¿”å›ï¼Œå…¶ Pointer æŒ‡å‘ä¸€ä¸ª 0 byte åœ°å€ï¼ˆä¸ä¼šä¿ç•™è€çš„ Array æŒ‡å‘ï¼‰

### æ‰©å®¹ - è®¡ç®—ç­–ç•¥

```go
func growslice(et *_type, old slice, cap int) slice {
    ...
    newcap := old.cap
	doublecap := newcap + newcap
	if cap > doublecap {
		newcap = cap
	} else {
		if old.len < 1024 {
			newcap = doublecap
		} else {
			for 0 < newcap && newcap < cap {
				newcap += newcap / 4
			}
			...
		}
	}
	...
}
```

- è‹¥ Slice cap å¤§äº doublecapï¼Œåˆ™æ‰©å®¹åå®¹é‡å¤§å°ä¸º æ–° Slice çš„å®¹é‡ï¼ˆè¶…äº†åŸºå‡†å€¼ï¼Œæˆ‘å°±åªç»™ä½ éœ€è¦çš„å®¹é‡å¤§å°ï¼‰
- è‹¥ Slice len å°äº 1024 ä¸ªï¼Œåœ¨æ‰©å®¹æ—¶ï¼Œå¢é•¿å› å­ä¸º 1ï¼ˆä¹Ÿå°±æ˜¯ 3 ä¸ªå˜ 6 ä¸ªï¼‰
- è‹¥ Slice len å¤§äº 1024 ä¸ªï¼Œåœ¨æ‰©å®¹æ—¶ï¼Œå¢é•¿å› å­ä¸º 0.25ï¼ˆåŸæœ¬å®¹é‡çš„å››åˆ†ä¹‹ä¸€ï¼‰

æ³¨ï¼šä¹Ÿå°±æ˜¯å°äº 1024 ä¸ªæ—¶ï¼Œå¢é•¿ 2 å€ã€‚å¤§äº 1024 ä¸ªæ—¶ï¼Œå¢é•¿ 1.25 å€

### æ‰©å®¹ - å†…å­˜ç­–ç•¥

```go
func growslice(et *_type, old slice, cap int) slice {
    ...
    var overflow bool
	var lenmem, newlenmem, capmem uintptr
	const ptrSize = unsafe.Sizeof((*byte)(nil))
	switch et.size {
	case 1:
		lenmem = uintptr(old.len)
		newlenmem = uintptr(cap)
		capmem = roundupsize(uintptr(newcap))
		overflow = uintptr(newcap) > _MaxMem
		newcap = int(capmem)
	    ...
	}

	if cap < old.cap || overflow || capmem > _MaxMem {
		panic(errorString("growslice: cap out of range"))
	}

	var p unsafe.Pointer
	if et.kind&kindNoPointers != 0 {
		p = mallocgc(capmem, nil, false)
		memmove(p, old.array, lenmem)
		memclrNoHeapPointers(add(p, newlenmem), capmem-newlenmem)
	} else {
		p = mallocgc(capmem, et, true)
		if !writeBarrier.enabled {
			memmove(p, old.array, lenmem)
		} else {
			for i := uintptr(0); i < lenmem; i += et.size {
				typedmemmove(et, add(p, i), add(old.array, i))
			}
		}
	}
	...
}
```

1ã€è·å–è€ Slice é•¿åº¦å’Œè®¡ç®—å‡å®šæ‰©å®¹åçš„æ–° Slice å…ƒç´ é•¿åº¦ã€å®¹é‡å¤§å°ä»¥åŠæŒ‡é’ˆåœ°å€ï¼ˆç”¨äºåç»­æ“ä½œå†…å­˜çš„ä¸€ç³»åˆ—æ“ä½œï¼‰

2ã€ç¡®å®šæ–° Slice å®¹é‡å¤§äºè€ Siceï¼Œå¹¶ä¸”æ–°å®¹é‡å†…å­˜å°äºæŒ‡å®šçš„æœ€å¤§å†…å­˜ã€æ²¡æœ‰æº¢å‡ºã€‚å¦åˆ™æŠ›å‡ºå¼‚å¸¸

3ã€è‹¥å…ƒç´ ç±»å‹ä¸º `kindNoPointers`ï¼Œä¹Ÿå°±æ˜¯**éæŒ‡é’ˆ**ç±»å‹ã€‚åˆ™åœ¨è€ Slice åç»§ç»­æ‰©å®¹

- ç¬¬ä¸€æ­¥ï¼šæ ¹æ®å…ˆå‰è®¡ç®—çš„ `capmem`ï¼Œåœ¨è€ Slice cap åç»§ç»­ç”³è¯·å†…å­˜ç©ºé—´ï¼Œå…¶åç”¨äºæ‰©å®¹
- ç¬¬äºŒæ­¥ï¼šå°† old.array ä¸Šçš„ n ä¸ª bytesï¼ˆæ ¹æ® lenmemï¼‰æ‹·è´åˆ°æ–°çš„å†…å­˜ç©ºé—´ä¸Š
- ç¬¬ä¸‰æ­¥ï¼šæ–°å†…å­˜ç©ºé—´ï¼ˆpï¼‰åŠ ä¸Šæ–° Slice cap çš„å®¹é‡åœ°å€ã€‚æœ€ç»ˆå¾—åˆ°å®Œæ•´çš„æ–° Slice cap å†…å­˜åœ°å€ `add(p, newlenmem)` ï¼ˆptrï¼‰
- ç¬¬å››æ­¥ï¼šä» ptr å¼€å§‹é‡æ–°åˆå§‹åŒ– n ä¸ª bytesï¼ˆcapmem-newlenmemï¼‰

æ³¨ï¼šé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¸ºä»€ä¹ˆè¦é‡æ–°åˆå§‹åŒ–è¿™å—å†…å­˜å‘¢ï¼Ÿè¿™æ˜¯å› ä¸º ptr æ˜¯æœªåˆå§‹åŒ–çš„å†…å­˜ï¼ˆä¾‹å¦‚ï¼šå¯é‡ç”¨çš„å†…å­˜ï¼Œä¸€èˆ¬ç”¨äºæ–°çš„å†…å­˜åˆ†é…ï¼‰ï¼Œå…¶å¯èƒ½åŒ…å« â€œåƒåœ¾â€ã€‚å› æ­¤åœ¨è¿™é‡Œåº”å½“è¿›è¡Œ â€œæ¸…ç†â€ã€‚ä¾¿äºåé¢å®é™…ä½¿ç”¨ï¼ˆæ‰©å®¹ï¼‰

4ã€ä¸æ»¡è¶³ 3 çš„æƒ…å†µä¸‹ï¼Œé‡æ–°ç”³è¯·å¹¶åˆå§‹åŒ–ä¸€å—å†…å­˜ç»™æ–° Slice ç”¨äºå­˜å‚¨ Array

5ã€æ£€æµ‹å½“å‰æ˜¯å¦æ­£åœ¨æ‰§è¡Œ GCï¼Œä¹Ÿå°±æ˜¯å½“å‰æ˜¯å¦å¯ç”¨ Write Barrierï¼ˆå†™å±éšœï¼‰ï¼Œè‹¥**å¯ç”¨**åˆ™é€šè¿‡ `typedmemmove` æ–¹æ³•ï¼Œåˆ©ç”¨æŒ‡é’ˆè¿ç®—**å¾ªç¯æ‹·è´**ã€‚å¦åˆ™é€šè¿‡ `memmove` æ–¹æ³•é‡‡å–**æ•´ä½“æ‹·è´**çš„æ–¹å¼å°† lenmem ä¸ªå­—èŠ‚ä» old.array æ‹·è´åˆ° ptrï¼Œä»¥æ­¤è¾¾åˆ°æ›´é«˜çš„æ•ˆç‡

æ³¨ï¼šä¸€èˆ¬ä¼šåœ¨ GC æ ‡è®°é˜¶æ®µå¯ç”¨ Write Barrierï¼Œå¹¶ä¸” Write Barrier åªé’ˆå¯¹æŒ‡é’ˆå¯ç”¨ã€‚é‚£ä¹ˆåœ¨ç¬¬ 5 ç‚¹ä¸­ï¼Œä½ å°±ä¸éš¾ç†è§£ä¸ºä»€ä¹ˆä¼šæœ‰ä¸¤ç§æˆªç„¶ä¸åŒçš„å¤„ç†æ–¹å¼äº†

#### å°ç»“

è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‰©å®¹æ—¶çš„å†…å­˜ç®¡ç†çš„é€‰æ‹©é¡¹ï¼Œå¦‚ä¸‹ï¼š

- ç¿»æ–°æ‰©å±•ï¼šå½“å‰å…ƒç´ ä¸º `kindNoPointers`ï¼Œå°†åœ¨è€ Slice cap çš„åœ°å€åç»§ç»­ç”³è¯·ç©ºé—´ç”¨äºæ‰©å®¹
- ä¸¾å®¶æ¬è¿ï¼šé‡æ–°ç”³è¯·ä¸€å—å†…å­˜åœ°å€ï¼Œæ•´ä½“è¿ç§»å¹¶æ‰©å®¹

### ä¸¤ä¸ªå° â€œé™·é˜±â€

#### ä¸€ã€åŒæ ¹

```go
func main() {
	nums := [3]int{}
	nums[0] = 1

	fmt.Printf("nums: %v , len: %d, cap: %d\n", nums, len(nums), cap(nums))

	dnums := nums[0:2]
	dnums[0] = 5

	fmt.Printf("nums: %v ,len: %d, cap: %d\n", nums, len(nums), cap(nums))
	fmt.Printf("dnums: %v, len: %d, cap: %d\n", dnums, len(dnums), cap(dnums))
}
```

è¾“å‡ºç»“æœï¼š

```
nums: [1 0 0] , len: 3, cap: 3
nums: [5 0 0] ,len: 3, cap: 3
dnums: [5 0], len: 2, cap: 3
```

åœ¨**æœªæ‰©å®¹å‰**ï¼ŒSlice array æŒ‡å‘æ‰€å¼•ç”¨çš„ Arrayã€‚å› æ­¤åœ¨ Slice ä¸Šçš„å˜æ›´ã€‚ä¼šç›´æ¥ä¿®æ”¹åˆ°åŸå§‹ Array ä¸Šï¼ˆä¸¤è€…æ‰€å¼•ç”¨çš„æ˜¯åŒä¸€ä¸ªï¼‰

![image](https://s2.ax1x.com/2020/02/27/3wnibn.png)

#### äºŒã€æ—¶è¿‡å¢ƒè¿

éšç€ Slice ä¸æ–­ appendï¼Œå†…åœ¨çš„å…ƒç´ è¶Šæ¥è¶Šå¤šï¼Œç»ˆäºè§¦å‘äº†æ‰©å®¹ã€‚å¦‚ä¸‹ä»£ç ï¼š

```go
func main() {
	nums := [3]int{}
	nums[0] = 1

	fmt.Printf("nums: %v , len: %d, cap: %d\n", nums, len(nums), cap(nums))

	dnums := nums[0:2]
	dnums = append(dnums, []int{2, 3}...)
	dnums[1] = 1

	fmt.Printf("nums: %v ,len: %d, cap: %d\n", nums, len(nums), cap(nums))
	fmt.Printf("dnums: %v, len: %d, cap: %d\n", dnums, len(dnums), cap(dnums))
}
```

è¾“å‡ºç»“æœï¼š

```
nums: [1 0 0] , len: 3, cap: 3
nums: [1 0 0] ,len: 3, cap: 3
dnums: [1 1 2 3], len: 4, cap: 6
```

å¾€ Slice append å…ƒç´ æ—¶ï¼Œè‹¥æ»¡è¶³æ‰©å®¹ç­–ç•¥ï¼Œä¹Ÿå°±æ˜¯å‡è®¾æ’å…¥åï¼ŒåŸæœ¬æ•°ç»„çš„å®¹é‡å°±è¶…è¿‡æœ€å¤§å€¼äº†

è¿™æ—¶å€™å†…éƒ¨å°±ä¼šé‡æ–°ç”³è¯·ä¸€å—å†…å­˜ç©ºé—´ï¼Œå°†åŸæœ¬çš„å…ƒç´ **æ‹·è´**ä¸€ä»½åˆ°æ–°çš„å†…å­˜ç©ºé—´ä¸Šã€‚æ­¤æ—¶å…¶ä¸åŸæœ¬çš„æ•°ç»„å°±æ²¡æœ‰ä»»ä½•å…³è”å…³ç³»äº†ï¼Œ**å†è¿›è¡Œä¿®æ”¹å€¼ä¹Ÿä¸ä¼šå˜åŠ¨åˆ°åŸå§‹æ•°ç»„**ã€‚è¿™æ˜¯éœ€è¦æ³¨æ„çš„

![image](https://s2.ax1x.com/2020/02/27/3wnAU0.png)

## å¤åˆ¶

### åŸå‹

```go
func copyï¼ˆdstï¼Œsrc [] Tï¼‰int
```

copy å‡½æ•°å°†æ•°æ®ä»**æº Slice**å¤åˆ¶åˆ°**ç›®æ ‡ Slice**ã€‚å®ƒè¿”å›å¤åˆ¶çš„å…ƒç´ æ•°ã€‚

### ç¤ºä¾‹

```go
func main() {
	dst := []int{1, 2, 3}
	src := []int{4, 5, 6, 7, 8}
	n := copy(dst, src)

	fmt.Printf("dst: %v, n: %d", dst, n)
}
```

copy å‡½æ•°æ”¯æŒåœ¨ä¸åŒé•¿åº¦çš„ Slice ä¹‹é—´è¿›è¡Œå¤åˆ¶ï¼Œè‹¥å‡ºç°é•¿åº¦ä¸ä¸€è‡´ï¼Œåœ¨å¤åˆ¶æ—¶ä¼šæŒ‰ç…§æœ€å°‘çš„ Slice å…ƒç´ ä¸ªæ•°è¿›è¡Œå¤åˆ¶

é‚£ä¹ˆåœ¨æºç ä¸­æ˜¯å¦‚ä½•å®Œæˆå¤åˆ¶è¿™ä¸€ä¸ªè¡Œä¸ºçš„å‘¢ï¼Ÿæˆ‘ä»¬æ¥ä¸€èµ·çœ‹çœ‹æºç çš„å®ç°ï¼Œå¦‚ä¸‹ï¼š

```go
func slicecopy(to, fm slice, width uintptr) int {
	if fm.len == 0 || to.len == 0 {
		return 0
	}

	n := fm.len
	if to.len < n {
		n = to.len
	}

	if width == 0 {
		return n
	}

	...

	size := uintptr(n) * width
	if size == 1 {
		*(*byte)(to.array) = *(*byte)(fm.array) // known to be a byte pointer
	} else {
		memmove(to.array, fm.array, size)
	}
	return n
}
```

- è‹¥æº Slice æˆ–ç›®æ ‡ Slice å­˜åœ¨é•¿åº¦ä¸º 0 çš„æƒ…å†µï¼Œåˆ™ç›´æ¥è¿”å› 0ï¼ˆå› ä¸ºå‹æ ¹ä¸éœ€è¦æ‰§è¡Œå¤åˆ¶è¡Œä¸ºï¼‰
- é€šè¿‡å¯¹æ¯”ä¸¤ä¸ª Sliceï¼Œè·å–æœ€å°çš„ Slice é•¿åº¦ã€‚ä¾¿äºåç»­æ“ä½œ
- è‹¥ Slice åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œåˆ™ç›´æ¥åˆ©ç”¨æŒ‡é’ˆçš„ç‰¹æ€§è¿›è¡Œè½¬æ¢
- è‹¥ Slice å¤§äºä¸€ä¸ªå…ƒç´ ï¼Œåˆ™ä» `fm.array` å¤åˆ¶ `size` ä¸ªå­—èŠ‚åˆ° `to.array` çš„åœ°å€å¤„ï¼ˆä¼šè¦†ç›–åŸæœ‰çš„å€¼ï¼‰

## "å¥‡ç‰¹"çš„åˆå§‹åŒ–

åœ¨ Slice ä¸­æµä¼ ç€ä¸¤ä¸ªä¼ è¯´ï¼Œåˆ†åˆ«æ˜¯ Empty å’Œ Nil Sliceï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬çœ‹çœ‹å®ƒä»¬çš„å°åŒºåˆ« ğŸ¤“

### Empty

```go
func main() {
	nums := []int{}
	renums := make([]int, 0)

	fmt.Printf("nums: %v, len: %d, cap: %d\n", nums, len(nums), cap(nums))
	fmt.Printf("renums: %v, len: %d, cap: %d\n", renums, len(renums), cap(renums))
}
```

è¾“å‡ºç»“æœï¼š

```
nums: [], len: 0, cap: 0
renums: [], len: 0, cap: 0
```

### Nil

```go
func main() {
    var nums []int
}
```

è¾“å‡ºç»“æœï¼š

```
nums: [], len: 0, cap: 0
```

### æƒ³ä¸€æƒ³

ä¹ä¸€çœ‹ï¼ŒEmpty Slice å’Œ Nil Slice å¥½åƒä¸€æ¨¡ä¸€æ ·ï¼Ÿä¸ç®¡æ˜¯ lenï¼Œè¿˜æ˜¯ cap éƒ½ä¸º 0ã€‚å¥½åƒæ²¡åŒºåˆ«ï¼Ÿæˆ‘ä»¬å†çœ‹çœ‹å¦‚ä¸‹ä»£ç ï¼š

```go
func main() {
	var nums []int
	renums := make([]int, 0)
	if nums == nil {
		fmt.Println("nums is nil.")
	}
	if renums == nil {
		fmt.Println("renums is nil.")
	}
}
```

ä½ è§‰å¾—è¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä½ å¯èƒ½å·²ç»æƒ³åˆ°äº†ï¼Œæœ€ç»ˆçš„è¾“å‡ºç»“æœï¼š

```
nums is nil.
```

#### ä¸ºä»€ä¹ˆ

##### Empty

![image](https://s2.ax1x.com/2020/02/27/3wncRS.png)

##### Nil

![image](https://s2.ax1x.com/2020/02/27/3wn5aq.png)

ä»å›¾ç¤ºä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼Œä¸¤è€…æœ‰æœ¬è´¨ä¸Šçš„åŒºåˆ«ã€‚å…¶åº•å±‚æ•°ç»„çš„æŒ‡å‘æŒ‡é’ˆæ˜¯ä¸ä¸€æ ·çš„ï¼ŒNil Slice æŒ‡å‘çš„æ˜¯ nilï¼ŒEmpty Slice æŒ‡å‘çš„æ˜¯å®é™…å­˜åœ¨çš„ç©ºæ•°ç»„åœ°å€

ä½ å¯ä»¥è®¤ä¸ºï¼ŒNil Slice ä»£æŒ‡ä¸å­˜åœ¨çš„ Sliceï¼ŒEmpty Slice ä»£æŒ‡ç©ºé›†åˆã€‚ä¸¤è€…æ‰€ä»£è¡¨çš„æ„ä¹‰æ˜¯å®Œå…¨ä¸åŒçš„

## æ€»ç»“

é€šè¿‡æœ¬æ–‡ï¼Œå¯å¾—çŸ¥ Go Slice ç›¸å½“çµæ´»ã€‚ä¸éœ€è¦ä½ æ‰‹åŠ¨æ‰©å®¹ï¼Œä¹Ÿä¸éœ€è¦ä½ å…³æ³¨åŠ å¤šå°‘å‡å¤šå°‘ã€‚å¯¹ Array æ˜¯åŠ¨æ€å¼•ç”¨ï¼Œæ˜¯ Go ç±»å‹çš„ä¸€ä¸ªæå¤§çš„è¡¥å……ï¼Œä¹Ÿå› æ­¤åœ¨åº”ç”¨ä¸­ä½¿ç”¨çš„æ›´å¤šã€æ›´ä¾¿æ·

è™½ç„¶æœ‰ä¸ªåˆ«è¦æ³¨æ„çš„ â€œå‘â€ï¼Œä½†å…¶å®æ˜¯åˆç†çš„ã€‚ä½ è§‰å¾—å‘¢ï¼ŸğŸ˜„

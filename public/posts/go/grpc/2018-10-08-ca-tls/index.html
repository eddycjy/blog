<!DOCTYPE html>
<html lang="zh-hans">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<meta name="theme-color" content="#494f5c">
	<meta name="msapplication-TileColor" content="#494f5c">
<meta itemprop="name" content="ã€Œè¿è½½äº”ã€åŸºäº CA çš„ TLS è¯ä¹¦è®¤è¯">
<meta itemprop="description" content="å‰è¨€ åœ¨ä¸Šä¸€ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªé—®é¢˜ã€‚å°±æ˜¯å¦‚ä½•ä¿è¯è¯ä¹¦çš„å¯é æ€§å’Œæœ‰æ•ˆæ€§ï¼Ÿä½ å¦‚ä½•ç¡®å®šä½  Serverã€Client çš„è¯ä¹¦æ˜¯å¯¹çš„å‘¢ï¼Ÿ
CA ä¸ºäº†ä¿è¯è¯ä¹¦çš„å¯é æ€§å’Œæœ‰æ•ˆæ€§ï¼Œåœ¨è¿™é‡Œå¯å¼•å…¥ CA é¢å‘çš„æ ¹è¯ä¹¦çš„æ¦‚å¿µã€‚å…¶éµå®ˆ X.509 æ ‡å‡†
æ ¹è¯ä¹¦ æ ¹è¯ä¹¦ï¼ˆroot certificateï¼‰æ˜¯å±äºæ ¹è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰çš„å…¬é’¥è¯ä¹¦ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡éªŒè¯ CA çš„ç­¾åä»è€Œä¿¡ä»» CA ï¼Œä»»ä½•äººéƒ½å¯ä»¥å¾—åˆ° CA çš„è¯ä¹¦ï¼ˆå«å…¬é’¥ï¼‰ï¼Œç”¨ä»¥éªŒè¯å®ƒæ‰€ç­¾å‘çš„è¯ä¹¦ï¼ˆå®¢æˆ·ç«¯ã€æœåŠ¡ç«¯ï¼‰
å®ƒåŒ…å«çš„æ–‡ä»¶å¦‚ä¸‹ï¼š
 å…¬é’¥ å¯†é’¥  ç”Ÿæˆ Key openssl genrsa -out ca.key 2048 ç”Ÿæˆå¯†é’¥ openssl req -new -x509 -days 7200 -key ca.key -out ca.pem å¡«å†™ä¿¡æ¯ Country Name (2 letter code) []: State or Province Name (full name) []: Locality Name (eg, city) []: Organization Name (eg, company) []: Organizational Unit Name (eg, section) []: Common Name (eg, fully qualified host name) []:go-grpc-example Email Address []: Server ç”Ÿæˆ CSR openssl req -new -key server.">
<meta itemprop="datePublished" content="2018-10-08T12:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2018-10-08T12:00:00&#43;00:00" />
<meta itemprop="wordCount" content="590">



<meta itemprop="keywords" content="go,grpc," /><meta property="og:title" content="ã€Œè¿è½½äº”ã€åŸºäº CA çš„ TLS è¯ä¹¦è®¤è¯" />
<meta property="og:description" content="å‰è¨€ åœ¨ä¸Šä¸€ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªé—®é¢˜ã€‚å°±æ˜¯å¦‚ä½•ä¿è¯è¯ä¹¦çš„å¯é æ€§å’Œæœ‰æ•ˆæ€§ï¼Ÿä½ å¦‚ä½•ç¡®å®šä½  Serverã€Client çš„è¯ä¹¦æ˜¯å¯¹çš„å‘¢ï¼Ÿ
CA ä¸ºäº†ä¿è¯è¯ä¹¦çš„å¯é æ€§å’Œæœ‰æ•ˆæ€§ï¼Œåœ¨è¿™é‡Œå¯å¼•å…¥ CA é¢å‘çš„æ ¹è¯ä¹¦çš„æ¦‚å¿µã€‚å…¶éµå®ˆ X.509 æ ‡å‡†
æ ¹è¯ä¹¦ æ ¹è¯ä¹¦ï¼ˆroot certificateï¼‰æ˜¯å±äºæ ¹è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰çš„å…¬é’¥è¯ä¹¦ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡éªŒè¯ CA çš„ç­¾åä»è€Œä¿¡ä»» CA ï¼Œä»»ä½•äººéƒ½å¯ä»¥å¾—åˆ° CA çš„è¯ä¹¦ï¼ˆå«å…¬é’¥ï¼‰ï¼Œç”¨ä»¥éªŒè¯å®ƒæ‰€ç­¾å‘çš„è¯ä¹¦ï¼ˆå®¢æˆ·ç«¯ã€æœåŠ¡ç«¯ï¼‰
å®ƒåŒ…å«çš„æ–‡ä»¶å¦‚ä¸‹ï¼š
 å…¬é’¥ å¯†é’¥  ç”Ÿæˆ Key openssl genrsa -out ca.key 2048 ç”Ÿæˆå¯†é’¥ openssl req -new -x509 -days 7200 -key ca.key -out ca.pem å¡«å†™ä¿¡æ¯ Country Name (2 letter code) []: State or Province Name (full name) []: Locality Name (eg, city) []: Organization Name (eg, company) []: Organizational Unit Name (eg, section) []: Common Name (eg, fully qualified host name) []:go-grpc-example Email Address []: Server ç”Ÿæˆ CSR openssl req -new -key server." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://eddycjy.com/posts/go/grpc/2018-10-08-ca-tls/" />
<meta property="article:published_time" content="2018-10-08T12:00:00+00:00" />
<meta property="article:modified_time" content="2018-10-08T12:00:00+00:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="ã€Œè¿è½½äº”ã€åŸºäº CA çš„ TLS è¯ä¹¦è®¤è¯"/>
<meta name="twitter:description" content="å‰è¨€ åœ¨ä¸Šä¸€ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªé—®é¢˜ã€‚å°±æ˜¯å¦‚ä½•ä¿è¯è¯ä¹¦çš„å¯é æ€§å’Œæœ‰æ•ˆæ€§ï¼Ÿä½ å¦‚ä½•ç¡®å®šä½  Serverã€Client çš„è¯ä¹¦æ˜¯å¯¹çš„å‘¢ï¼Ÿ
CA ä¸ºäº†ä¿è¯è¯ä¹¦çš„å¯é æ€§å’Œæœ‰æ•ˆæ€§ï¼Œåœ¨è¿™é‡Œå¯å¼•å…¥ CA é¢å‘çš„æ ¹è¯ä¹¦çš„æ¦‚å¿µã€‚å…¶éµå®ˆ X.509 æ ‡å‡†
æ ¹è¯ä¹¦ æ ¹è¯ä¹¦ï¼ˆroot certificateï¼‰æ˜¯å±äºæ ¹è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰çš„å…¬é’¥è¯ä¹¦ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡éªŒè¯ CA çš„ç­¾åä»è€Œä¿¡ä»» CA ï¼Œä»»ä½•äººéƒ½å¯ä»¥å¾—åˆ° CA çš„è¯ä¹¦ï¼ˆå«å…¬é’¥ï¼‰ï¼Œç”¨ä»¥éªŒè¯å®ƒæ‰€ç­¾å‘çš„è¯ä¹¦ï¼ˆå®¢æˆ·ç«¯ã€æœåŠ¡ç«¯ï¼‰
å®ƒåŒ…å«çš„æ–‡ä»¶å¦‚ä¸‹ï¼š
 å…¬é’¥ å¯†é’¥  ç”Ÿæˆ Key openssl genrsa -out ca.key 2048 ç”Ÿæˆå¯†é’¥ openssl req -new -x509 -days 7200 -key ca.key -out ca.pem å¡«å†™ä¿¡æ¯ Country Name (2 letter code) []: State or Province Name (full name) []: Locality Name (eg, city) []: Organization Name (eg, company) []: Organizational Unit Name (eg, section) []: Common Name (eg, fully qualified host name) []:go-grpc-example Email Address []: Server ç”Ÿæˆ CSR openssl req -new -key server."/>

	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
	<link rel="shortcut icon" href="/favicon.ico">

	<title>ã€Œè¿è½½äº”ã€åŸºäº CA çš„ TLS è¯ä¹¦è®¤è¯</title>
	<link rel="stylesheet" href="https://eddycjy.com/css/style.min.43ade9343bda1e3f53fcb45dc776c310b369f2a93c03dee67c82401987989309.css">
	
</head>

<body id="page">
	
	<header id="site-header" class="animated slideInUp faster">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					<a href="https://eddycjy.com">ç…é±¼</a>
				</div>
				<nav class="site-nav hide-in-mobile">
					<a href="https://eddycjy.com/posts/">Posts</a>
					<a href="https://eddycjy.com/tags/">Tags</a>
					<a href="https://eddycjy.com/about/">About</a>
				</nav>
			</div>
			<div class="hdr-right hdr-icons">
				<button id="toc-btn" class="hdr-btn desktop-only-ib" title="Table of Contents"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-list"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3" y2="6"></line><line x1="3" y1="12" x2="3" y2="12"></line><line x1="3" y1="18" x2="3" y2="18"></line></svg></button><span class="hdr-social hide-in-mobile"><a href="https://github.com/eddycjy" target="_blank" rel="noopener me" title="Github"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a></span><button id="menu-btn" class="hdr-btn" title="Menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast">
		<ul>
			<li><a href="https://eddycjy.com/posts/">Posts</a></li>
			<li><a href="https://eddycjy.com/tags/">Tags</a></li>
			<li><a href="https://eddycjy.com/about/">About</a></li>
		</ul>
	</div>


	<main class="site-main section-inner animated fadeIn faster">
		<article class="thin">
			<header class="post-header">
				<div class="post-meta"><span>Oct 8, 2018</span></div>
				<h1>ã€Œè¿è½½äº”ã€åŸºäº CA çš„ TLS è¯ä¹¦è®¤è¯</h1>
			</header>
			<div class="content">
				<h2 id="å‰è¨€">å‰è¨€<a href="#å‰è¨€" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>åœ¨ä¸Šä¸€ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªé—®é¢˜ã€‚å°±æ˜¯å¦‚ä½•ä¿è¯è¯ä¹¦çš„å¯é æ€§å’Œæœ‰æ•ˆæ€§ï¼Ÿä½ å¦‚ä½•ç¡®å®šä½  Serverã€Client çš„è¯ä¹¦æ˜¯å¯¹çš„å‘¢ï¼Ÿ</p>
<h2 id="ca">CA<a href="#ca" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>ä¸ºäº†ä¿è¯è¯ä¹¦çš„å¯é æ€§å’Œæœ‰æ•ˆæ€§ï¼Œåœ¨è¿™é‡Œå¯å¼•å…¥ CA é¢å‘çš„æ ¹è¯ä¹¦çš„æ¦‚å¿µã€‚å…¶éµå®ˆ X.509 æ ‡å‡†</p>
<h3 id="æ ¹è¯ä¹¦">æ ¹è¯ä¹¦<a href="#æ ¹è¯ä¹¦" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>æ ¹è¯ä¹¦ï¼ˆroot certificateï¼‰æ˜¯å±äºæ ¹è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰çš„å…¬é’¥è¯ä¹¦ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡éªŒè¯ CA çš„ç­¾åä»è€Œä¿¡ä»» CA ï¼Œä»»ä½•äººéƒ½å¯ä»¥å¾—åˆ° CA çš„è¯ä¹¦ï¼ˆå«å…¬é’¥ï¼‰ï¼Œç”¨ä»¥éªŒè¯å®ƒæ‰€ç­¾å‘çš„è¯ä¹¦ï¼ˆå®¢æˆ·ç«¯ã€æœåŠ¡ç«¯ï¼‰</p>
<p>å®ƒåŒ…å«çš„æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<ul>
<li>å…¬é’¥</li>
<li>å¯†é’¥</li>
</ul>
<h3 id="ç”Ÿæˆ-key">ç”Ÿæˆ Key<a href="#ç”Ÿæˆ-key" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<pre><code>openssl genrsa -out ca.key 2048
</code></pre><h3 id="ç”Ÿæˆå¯†é’¥">ç”Ÿæˆå¯†é’¥<a href="#ç”Ÿæˆå¯†é’¥" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<pre><code>openssl req -new -x509 -days 7200 -key ca.key -out ca.pem
</code></pre><h4 id="å¡«å†™ä¿¡æ¯">å¡«å†™ä¿¡æ¯<a href="#å¡«å†™ä¿¡æ¯" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<pre><code>Country Name (2 letter code) []:
State or Province Name (full name) []:
Locality Name (eg, city) []:
Organization Name (eg, company) []:
Organizational Unit Name (eg, section) []:
Common Name (eg, fully qualified host name) []:go-grpc-example
Email Address []:
</code></pre><h3 id="server">Server<a href="#server" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<h4 id="ç”Ÿæˆ-csr">ç”Ÿæˆ CSR<a href="#ç”Ÿæˆ-csr" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<pre><code>openssl req -new -key server.key -out server.csr
</code></pre><h5 id="å¡«å†™ä¿¡æ¯-1">å¡«å†™ä¿¡æ¯<a href="#å¡«å†™ä¿¡æ¯-1" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h5>
<pre><code>Country Name (2 letter code) []:
State or Province Name (full name) []:
Locality Name (eg, city) []:
Organization Name (eg, company) []:
Organizational Unit Name (eg, section) []:
Common Name (eg, fully qualified host name) []:go-grpc-example
Email Address []:

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:
</code></pre><p>CSR æ˜¯ Cerificate Signing Request çš„è‹±æ–‡ç¼©å†™ï¼Œä¸ºè¯ä¹¦è¯·æ±‚æ–‡ä»¶ã€‚ä¸»è¦ä½œç”¨æ˜¯ CA ä¼šåˆ©ç”¨ CSR æ–‡ä»¶è¿›è¡Œç­¾åä½¿å¾—æ”»å‡»è€…æ— æ³•ä¼ªè£…æˆ–ç¯¡æ”¹åŸæœ‰è¯ä¹¦</p>
<h4 id="åŸºäº-ca-ç­¾å‘">åŸºäº CA ç­¾å‘<a href="#åŸºäº-ca-ç­¾å‘" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<pre><code>openssl x509 -req -sha256 -CA ca.pem -CAkey ca.key -CAcreateserial -days 3650 -in server.csr -out server.pem
</code></pre><h3 id="client">Client<a href="#client" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<h3 id="ç”Ÿæˆ-key-1">ç”Ÿæˆ Key<a href="#ç”Ÿæˆ-key-1" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<pre><code>openssl ecparam -genkey -name secp384r1 -out client.key
</code></pre><h3 id="ç”Ÿæˆ-csr-1">ç”Ÿæˆ CSR<a href="#ç”Ÿæˆ-csr-1" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<pre><code>openssl req -new -key client.key -out client.csr
</code></pre><h4 id="åŸºäº-ca-ç­¾å‘-1">åŸºäº CA ç­¾å‘<a href="#åŸºäº-ca-ç­¾å‘-1" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<pre><code>openssl x509 -req -sha256 -CA ca.pem -CAkey ca.key -CAcreateserial -days 3650 -in client.csr -out client.pem
</code></pre><h3 id="æ•´ç†ç›®å½•">æ•´ç†ç›®å½•<a href="#æ•´ç†ç›®å½•" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>è‡³æ­¤æˆ‘ä»¬ç”Ÿæˆäº†ä¸€å †æ–‡ä»¶ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹ç›®å½•ç»“æ„å­˜æ”¾ï¼š</p>
<pre><code>$ tree conf 
conf
â”œâ”€â”€ ca.key
â”œâ”€â”€ ca.pem
â”œâ”€â”€ ca.srl
â”œâ”€â”€ client
â”‚Â Â  â”œâ”€â”€ client.csr
â”‚Â Â  â”œâ”€â”€ client.key
â”‚Â Â  â””â”€â”€ client.pem
â””â”€â”€ server
    â”œâ”€â”€ server.csr
    â”œâ”€â”€ server.key
    â””â”€â”€ server.pem
</code></pre><p>å¦å¤–æœ‰ä¸€äº›æ–‡ä»¶æ˜¯ä¸åº”è¯¥å‡ºç°åœ¨ä»“åº“å†…ï¼Œåº”å½“ä¿å¯†æˆ–åˆ é™¤çš„ã€‚ä½†ä¸ºäº†çœŸå®æ¼”ç¤ºæ‰€ä»¥ä¿ç•™ç€ï¼ˆæ•²é»‘æ¿ï¼‰</p>
<h2 id="grpc">gRPC<a href="#grpc" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>æ¥ä¸‹æ¥å°†æ­£å¼å¼€å§‹é’ˆå¯¹ gRPC è¿›è¡Œç¼–ç ï¼Œæ”¹é€ ä¸Šä¸€ç« èŠ‚çš„ä»£ç ã€‚ç›®æ ‡æ˜¯åŸºäº CA è¿›è¡Œ TLS è®¤è¯ ğŸ¤«</p>
<h3 id="server-1">Server<a href="#server-1" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<pre><code>package main

import (
	&quot;context&quot;
	&quot;log&quot;
	&quot;net&quot;
	&quot;crypto/tls&quot;
	&quot;crypto/x509&quot;
	&quot;io/ioutil&quot;

	&quot;google.golang.org/grpc&quot;
	&quot;google.golang.org/grpc/credentials&quot;

	pb &quot;github.com/EDDYCJY/go-grpc-example/proto&quot;
)

...

const PORT = &quot;9001&quot;

func main() {
	cert, err := tls.LoadX509KeyPair(&quot;../../conf/server/server.pem&quot;, &quot;../../conf/server/server.key&quot;)
	if err != nil {
		log.Fatalf(&quot;tls.LoadX509KeyPair err: %v&quot;, err)
	}

	certPool := x509.NewCertPool()
	ca, err := ioutil.ReadFile(&quot;../../conf/ca.pem&quot;)
	if err != nil {
		log.Fatalf(&quot;ioutil.ReadFile err: %v&quot;, err)
	}

	if ok := certPool.AppendCertsFromPEM(ca); !ok {
		log.Fatalf(&quot;certPool.AppendCertsFromPEM err&quot;)
	}

	c := credentials.NewTLS(&amp;tls.Config{
		Certificates: []tls.Certificate{cert},
		ClientAuth:   tls.RequireAndVerifyClientCert,
		ClientCAs:    certPool,
	})

	server := grpc.NewServer(grpc.Creds(c))
	pb.RegisterSearchServiceServer(server, &amp;SearchService{})

	lis, err := net.Listen(&quot;tcp&quot;, &quot;:&quot;+PORT)
	if err != nil {
		log.Fatalf(&quot;net.Listen err: %v&quot;, err)
	}

	server.Serve(lis)
}
</code></pre><ul>
<li>tls.LoadX509KeyPair()ï¼šä»è¯ä¹¦ç›¸å…³æ–‡ä»¶ä¸­<strong>è¯»å–</strong>å’Œ<strong>è§£æ</strong>ä¿¡æ¯ï¼Œå¾—åˆ°è¯ä¹¦å…¬é’¥ã€å¯†é’¥å¯¹</li>
</ul>
<pre><code>func LoadX509KeyPair(certFile, keyFile string) (Certificate, error) {
	certPEMBlock, err := ioutil.ReadFile(certFile)
	if err != nil {
		return Certificate{}, err
	}
	keyPEMBlock, err := ioutil.ReadFile(keyFile)
	if err != nil {
		return Certificate{}, err
	}
	return X509KeyPair(certPEMBlock, keyPEMBlock)
}
</code></pre><ul>
<li>x509.NewCertPool()ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ã€ç©ºçš„ CertPool</li>
<li>certPool.AppendCertsFromPEM()ï¼šå°è¯•è§£ææ‰€ä¼ å…¥çš„ PEM ç¼–ç çš„è¯ä¹¦ã€‚å¦‚æœè§£ææˆåŠŸä¼šå°†å…¶åŠ åˆ° CertPool ä¸­ï¼Œä¾¿äºåé¢çš„ä½¿ç”¨</li>
<li>credentials.NewTLSï¼šæ„å»ºåŸºäº TLS çš„ TransportCredentials é€‰é¡¹</li>
<li>tls.Configï¼šConfig ç»“æ„ç”¨äºé…ç½® TLS å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨</li>
</ul>
<p>åœ¨ Serverï¼Œå…±ä½¿ç”¨äº†ä¸‰ä¸ª Config é…ç½®é¡¹ï¼š</p>
<p>ï¼ˆ1ï¼‰Certificatesï¼šè®¾ç½®è¯ä¹¦é“¾ï¼Œå…è®¸åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª</p>
<p>ï¼ˆ2ï¼‰ClientAuthï¼šè¦æ±‚å¿…é¡»æ ¡éªŒå®¢æˆ·ç«¯çš„è¯ä¹¦ã€‚å¯ä»¥æ ¹æ®å®é™…æƒ…å†µé€‰ç”¨ä»¥ä¸‹å‚æ•°ï¼š</p>
<pre><code>const (
	NoClientCert ClientAuthType = iota
	RequestClientCert
	RequireAnyClientCert
	VerifyClientCertIfGiven
	RequireAndVerifyClientCert
)
</code></pre><p>ï¼ˆ3ï¼‰ClientCAsï¼šè®¾ç½®æ ¹è¯ä¹¦çš„é›†åˆï¼Œæ ¡éªŒæ–¹å¼ä½¿ç”¨ ClientAuth ä¸­è®¾å®šçš„æ¨¡å¼</p>
<h3 id="client-1">Client<a href="#client-1" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<pre><code>package main

import (
	&quot;context&quot;
	&quot;crypto/tls&quot;
	&quot;crypto/x509&quot;
	&quot;io/ioutil&quot;
	&quot;log&quot;

	&quot;google.golang.org/grpc&quot;
	&quot;google.golang.org/grpc/credentials&quot;

	pb &quot;github.com/EDDYCJY/go-grpc-example/proto&quot;
)

const PORT = &quot;9001&quot;

func main() {
	cert, err := tls.LoadX509KeyPair(&quot;../../conf/client/client.pem&quot;, &quot;../../conf/client/client.key&quot;)
	if err != nil {
		log.Fatalf(&quot;tls.LoadX509KeyPair err: %v&quot;, err)
	}

	certPool := x509.NewCertPool()
	ca, err := ioutil.ReadFile(&quot;../../conf/ca.pem&quot;)
	if err != nil {
		log.Fatalf(&quot;ioutil.ReadFile err: %v&quot;, err)
	}

	if ok := certPool.AppendCertsFromPEM(ca); !ok {
		log.Fatalf(&quot;certPool.AppendCertsFromPEM err&quot;)
	}

	c := credentials.NewTLS(&amp;tls.Config{
		Certificates: []tls.Certificate{cert},
		ServerName:   &quot;go-grpc-example&quot;,
		RootCAs:      certPool,
	})

	conn, err := grpc.Dial(&quot;:&quot;+PORT, grpc.WithTransportCredentials(c))
	if err != nil {
		log.Fatalf(&quot;grpc.Dial err: %v&quot;, err)
	}
	defer conn.Close()

	client := pb.NewSearchServiceClient(conn)
	resp, err := client.Search(context.Background(), &amp;pb.SearchRequest{
		Request: &quot;gRPC&quot;,
	})
	if err != nil {
		log.Fatalf(&quot;client.Search err: %v&quot;, err)
	}

	log.Printf(&quot;resp: %s&quot;, resp.GetResponse())
}
</code></pre><p>åœ¨ Client ä¸­ç»å¤§éƒ¨åˆ†ä¸ Server ä¸€è‡´ï¼Œä¸åŒç‚¹çš„åœ°æ–¹æ˜¯ï¼Œåœ¨ Client è¯·æ±‚ Server ç«¯æ—¶ï¼ŒClient ç«¯ä¼šä½¿ç”¨æ ¹è¯ä¹¦å’Œ ServerName å»å¯¹ Server ç«¯è¿›è¡Œæ ¡éªŒ</p>
<p>ç®€å•æµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š</p>
<ol>
<li>Client é€šè¿‡è¯·æ±‚å¾—åˆ° Server ç«¯çš„è¯ä¹¦</li>
<li>ä½¿ç”¨ CA è®¤è¯çš„æ ¹è¯ä¹¦å¯¹ Server ç«¯çš„è¯ä¹¦è¿›è¡Œå¯é æ€§ã€æœ‰æ•ˆæ€§ç­‰æ ¡éªŒ</li>
<li>æ ¡éªŒ ServerName æ˜¯å¦å¯ç”¨ã€æœ‰æ•ˆ</li>
</ol>
<p>å½“ç„¶äº†ï¼Œåœ¨è®¾ç½®äº† <code>tls.RequireAndVerifyClientCert</code> æ¨¡å¼çš„æƒ…å†µä¸‹ï¼ŒServer ä¹Ÿä¼šä½¿ç”¨ CA è®¤è¯çš„æ ¹è¯ä¹¦å¯¹ Client ç«¯çš„è¯ä¹¦è¿›è¡Œå¯é æ€§ã€æœ‰æ•ˆæ€§ç­‰æ ¡éªŒã€‚ä¹Ÿå°±æ˜¯ä¸¤è¾¹éƒ½ä¼šè¿›è¡Œæ ¡éªŒï¼Œæå¤§çš„ä¿è¯äº†å®‰å…¨æ€§ ğŸ‘</p>
<h3 id="éªŒè¯">éªŒè¯<a href="#éªŒè¯" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>é‡æ–°å¯åŠ¨ server.go å’Œæ‰§è¡Œ client.goï¼ŒæŸ¥çœ‹å“åº”ç»“æœæ˜¯å¦æ­£å¸¸</p>
<h2 id="æ€»ç»“">æ€»ç»“<a href="#æ€»ç»“" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>åœ¨æœ¬ç« èŠ‚ï¼Œæˆ‘ä»¬ä½¿ç”¨ CA é¢å‘çš„æ ¹è¯ä¹¦å¯¹å®¢æˆ·ç«¯ã€æœåŠ¡ç«¯çš„è¯ä¹¦è¿›è¡Œäº†ç­¾å‘ã€‚è¿›ä¸€æ­¥çš„æé«˜äº†ä¸¤è€…çš„é€šè®¯å®‰å…¨</p>
<p>è¿™å›æ˜¯çœŸçš„å¤§åŠŸå‘Šæˆäº†ï¼</p>
<h2 id="å‚è€ƒ">å‚è€ƒ<a href="#å‚è€ƒ" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<h3 id="æœ¬ç³»åˆ—ç¤ºä¾‹ä»£ç ">æœ¬ç³»åˆ—ç¤ºä¾‹ä»£ç <a href="#æœ¬ç³»åˆ—ç¤ºä¾‹ä»£ç " class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<ul>
<li><a href="https://github.com/EDDYCJY/go-grpc-example">go-grpc-example</a></li>
</ul>

			</div>
			<hr class="post-end">
			<footer class="post-info">
				<p>
					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://eddycjy.com/tags/go">go</a></span><span class="tag"><a href="https://eddycjy.com/tags/grpc">grpc</a></span>
				</p>
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>590 Words</p>
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2018-10-08 20:00 &#43;0800</p>
			</footer>
		</article>
		<aside id="toc" class="show-toc">
			<div class="toc-title">Table of Contents</div>
			<nav id="TableOfContents">
  <ul>
    <li><a href="#å‰è¨€">å‰è¨€</a></li>
    <li><a href="#ca">CA</a>
      <ul>
        <li><a href="#æ ¹è¯ä¹¦">æ ¹è¯ä¹¦</a></li>
        <li><a href="#ç”Ÿæˆ-key">ç”Ÿæˆ Key</a></li>
        <li><a href="#ç”Ÿæˆå¯†é’¥">ç”Ÿæˆå¯†é’¥</a></li>
        <li><a href="#server">Server</a></li>
        <li><a href="#client">Client</a></li>
        <li><a href="#ç”Ÿæˆ-key-1">ç”Ÿæˆ Key</a></li>
        <li><a href="#ç”Ÿæˆ-csr-1">ç”Ÿæˆ CSR</a></li>
        <li><a href="#æ•´ç†ç›®å½•">æ•´ç†ç›®å½•</a></li>
      </ul>
    </li>
    <li><a href="#grpc">gRPC</a>
      <ul>
        <li><a href="#server-1">Server</a></li>
        <li><a href="#client-1">Client</a></li>
        <li><a href="#éªŒè¯">éªŒè¯</a></li>
      </ul>
    </li>
    <li><a href="#æ€»ç»“">æ€»ç»“</a></li>
    <li><a href="#å‚è€ƒ">å‚è€ƒ</a>
      <ul>
        <li><a href="#æœ¬ç³»åˆ—ç¤ºä¾‹ä»£ç ">æœ¬ç³»åˆ—ç¤ºä¾‹ä»£ç </a></li>
      </ul>
    </li>
  </ul>
</nav>
		</aside>
		<div class="post-nav thin">
			<a class="next-post" href="https://eddycjy.com/posts/go/grpc/2018-10-10-interceptor/">
				<span class="post-nav-label"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>&nbsp;Newer</span><br><span>ã€Œè¿è½½å…­ã€Unary and Stream interceptor</span>
			</a>
			<a class="prev-post" href="https://eddycjy.com/posts/go/grpc/2018-10-07-grpc-tls/">
				<span class="post-nav-label">Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><br><span>ã€Œè¿è½½å››ã€TLS è¯ä¹¦è®¤è¯</span>
			</a>
		</div>
		<div id="comments" class="thin">
						<script src="https://utteranc.es/client.js"
							repo="eddycjy/blog"
							issue-term="pathname"
							theme="github-light"
							crossorigin="anonymous"
							async>
			</script>
		</div>
	</main>

	<footer id="site-footer" class="section-inner thin animated fadeIn faster">
		<p>&copy; 2020 <a href="https://eddycjy.com">ç…é±¼</a> &#183; <a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></p>
		<p>
			Made with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> &#183; Theme <a href="https://github.com/Track3/hermit" target="_blank" rel="noopener">Hermit</a> &#183; <a href="https://eddycjy.com/post/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a>
		</p>
	</footer>


	<script src="https://eddycjy.com/js/main.min.784417f5847151f848c339cf0acb13a06cbb648b1483435a28ed4556c4ead69b.js"></script>

</body>

</html>

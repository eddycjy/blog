<!DOCTYPE html>
<html lang="zh-hans">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<meta name="theme-color" content="#494f5c">
	<meta name="msapplication-TileColor" content="#494f5c">
<meta itemprop="name" content="「连载二」Gin搭建Blog API&#39;s （一）">
<meta itemprop="description" content="思考 首先，在一个初始项目开始前，大家都要思考一下
  程序的文本配置写在代码中，好吗？
  API 的错误码硬编码在程序中，合适吗？
  db 句柄谁都去Open，没有统一管理，好吗？
  获取分页等公共参数，谁都自己写一套逻辑，好吗？
  显然在较正规的项目中，这些问题的答案都是不可以，为了解决这些问题，我们挑选一款读写配置文件的库，目前比较火的有 viper，有兴趣你未来可以简单了解一下，没兴趣的话等以后接触到再说。
但是本系列选用 go-ini/ini ，它的 中文文档。大家是必须需要要简单阅读它的文档，再接着完成后面的内容。
本文目标  编写一个简单的 API 错误码包。 完成一个 Demo 示例。 讲解 Demo 所涉及的知识点。  介绍和初始化项目 初始化项目目录 在前一章节中，我们初始化了一个 go-gin-example 项目，接下来我们需要继续新增如下目录结构：
go-gin-example/ ├── conf ├── middleware ├── models ├── pkg ├── routers └── runtime  conf：用于存储配置文件 middleware：应用中间件 models：应用数据库模型 pkg：第三方包 routers 路由逻辑处理 runtime：应用运行时数据  添加 Go Modules Replace 打开 go.mod 文件，新增 replace 配置项，如下：">
<meta itemprop="datePublished" content="2018-02-11T12:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2018-02-11T12:00:00&#43;00:00" />
<meta itemprop="wordCount" content="1252">



<meta itemprop="keywords" content="go,gin," /><meta property="og:title" content="「连载二」Gin搭建Blog API&#39;s （一）" />
<meta property="og:description" content="思考 首先，在一个初始项目开始前，大家都要思考一下
  程序的文本配置写在代码中，好吗？
  API 的错误码硬编码在程序中，合适吗？
  db 句柄谁都去Open，没有统一管理，好吗？
  获取分页等公共参数，谁都自己写一套逻辑，好吗？
  显然在较正规的项目中，这些问题的答案都是不可以，为了解决这些问题，我们挑选一款读写配置文件的库，目前比较火的有 viper，有兴趣你未来可以简单了解一下，没兴趣的话等以后接触到再说。
但是本系列选用 go-ini/ini ，它的 中文文档。大家是必须需要要简单阅读它的文档，再接着完成后面的内容。
本文目标  编写一个简单的 API 错误码包。 完成一个 Demo 示例。 讲解 Demo 所涉及的知识点。  介绍和初始化项目 初始化项目目录 在前一章节中，我们初始化了一个 go-gin-example 项目，接下来我们需要继续新增如下目录结构：
go-gin-example/ ├── conf ├── middleware ├── models ├── pkg ├── routers └── runtime  conf：用于存储配置文件 middleware：应用中间件 models：应用数据库模型 pkg：第三方包 routers 路由逻辑处理 runtime：应用运行时数据  添加 Go Modules Replace 打开 go.mod 文件，新增 replace 配置项，如下：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://eddycjy.com/posts/go/gin/2018-02-11-api-01/" />
<meta property="article:published_time" content="2018-02-11T12:00:00+00:00" />
<meta property="article:modified_time" content="2018-02-11T12:00:00+00:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="「连载二」Gin搭建Blog API&#39;s （一）"/>
<meta name="twitter:description" content="思考 首先，在一个初始项目开始前，大家都要思考一下
  程序的文本配置写在代码中，好吗？
  API 的错误码硬编码在程序中，合适吗？
  db 句柄谁都去Open，没有统一管理，好吗？
  获取分页等公共参数，谁都自己写一套逻辑，好吗？
  显然在较正规的项目中，这些问题的答案都是不可以，为了解决这些问题，我们挑选一款读写配置文件的库，目前比较火的有 viper，有兴趣你未来可以简单了解一下，没兴趣的话等以后接触到再说。
但是本系列选用 go-ini/ini ，它的 中文文档。大家是必须需要要简单阅读它的文档，再接着完成后面的内容。
本文目标  编写一个简单的 API 错误码包。 完成一个 Demo 示例。 讲解 Demo 所涉及的知识点。  介绍和初始化项目 初始化项目目录 在前一章节中，我们初始化了一个 go-gin-example 项目，接下来我们需要继续新增如下目录结构：
go-gin-example/ ├── conf ├── middleware ├── models ├── pkg ├── routers └── runtime  conf：用于存储配置文件 middleware：应用中间件 models：应用数据库模型 pkg：第三方包 routers 路由逻辑处理 runtime：应用运行时数据  添加 Go Modules Replace 打开 go.mod 文件，新增 replace 配置项，如下："/>

	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
	<link rel="shortcut icon" href="/favicon.ico">

	<title>「连载二」Gin搭建Blog API&#39;s （一）</title>
	<link rel="stylesheet" href="https://eddycjy.com/css/style.min.43ade9343bda1e3f53fcb45dc776c310b369f2a93c03dee67c82401987989309.css">
	
</head>

<body id="page">
	
	<header id="site-header" class="animated slideInUp faster">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					<a href="https://eddycjy.com">煎鱼</a>
				</div>
				<nav class="site-nav hide-in-mobile">
					<a href="https://eddycjy.com/posts/">Posts</a>
					<a href="https://eddycjy.com/tags/">Tags</a>
					<a href="https://eddycjy.com/about/">About</a>
				</nav>
			</div>
			<div class="hdr-right hdr-icons">
				<button id="toc-btn" class="hdr-btn desktop-only-ib" title="Table of Contents"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-list"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3" y2="6"></line><line x1="3" y1="12" x2="3" y2="12"></line><line x1="3" y1="18" x2="3" y2="18"></line></svg></button><span class="hdr-social hide-in-mobile"><a href="https://github.com/eddycjy" target="_blank" rel="noopener me" title="Github"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a></span><button id="menu-btn" class="hdr-btn" title="Menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast">
		<ul>
			<li><a href="https://eddycjy.com/posts/">Posts</a></li>
			<li><a href="https://eddycjy.com/tags/">Tags</a></li>
			<li><a href="https://eddycjy.com/about/">About</a></li>
		</ul>
	</div>


	<main class="site-main section-inner animated fadeIn faster">
		<article class="thin">
			<header class="post-header">
				<div class="post-meta"><span>Feb 11, 2018</span></div>
				<h1>「连载二」Gin搭建Blog API&#39;s （一）</h1>
			</header>
			<div class="content">
				<h2 id="思考">思考<a href="#思考" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>首先，在一个初始项目开始前，大家都要思考一下</p>
<ul>
<li>
<p>程序的文本配置写在代码中，好吗？</p>
</li>
<li>
<p>API 的错误码硬编码在程序中，合适吗？</p>
</li>
<li>
<p>db 句柄谁都去<code>Open</code>，没有统一管理，好吗？</p>
</li>
<li>
<p>获取分页等公共参数，谁都自己写一套逻辑，好吗？</p>
</li>
</ul>
<p>显然在较正规的项目中，这些问题的答案都是<strong>不可以</strong>，为了解决这些问题，我们挑选一款读写配置文件的库，目前比较火的有 <a href="https://github.com/spf13/viper">viper</a>，有兴趣你未来可以简单了解一下，没兴趣的话等以后接触到再说。</p>
<p>但是本系列选用 <a href="https://github.com/go-ini/ini">go-ini/ini</a> ，它的 <a href="https://ini.unknwon.io/">中文文档</a>。大家是必须需要要简单阅读它的文档，再接着完成后面的内容。</p>
<h2 id="本文目标">本文目标<a href="#本文目标" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<ul>
<li>编写一个简单的 API 错误码包。</li>
<li>完成一个 Demo 示例。</li>
<li>讲解 Demo 所涉及的知识点。</li>
</ul>
<h2 id="介绍和初始化项目">介绍和初始化项目<a href="#介绍和初始化项目" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<h3 id="初始化项目目录">初始化项目目录<a href="#初始化项目目录" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>在前一章节中，我们初始化了一个 <code>go-gin-example</code> 项目，接下来我们需要继续新增如下目录结构：</p>
<pre><code>go-gin-example/
├── conf
├── middleware
├── models
├── pkg
├── routers
└── runtime
</code></pre><ul>
<li>conf：用于存储配置文件</li>
<li>middleware：应用中间件</li>
<li>models：应用数据库模型</li>
<li>pkg：第三方包</li>
<li>routers 路由逻辑处理</li>
<li>runtime：应用运行时数据</li>
</ul>
<h3 id="添加-go-modules-replace">添加 Go Modules Replace<a href="#添加-go-modules-replace" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>打开 <code>go.mod</code> 文件，新增 <code>replace</code> 配置项，如下：</p>
<pre><code>module github.com/EDDYCJY/go-gin-example

go 1.13

require (...)

replace (
		github.com/EDDYCJY/go-gin-example/pkg/setting =&gt; ~/go-application/go-gin-example/pkg/setting
		github.com/EDDYCJY/go-gin-example/conf    	  =&gt; ~/go-application/go-gin-example/pkg/conf
		github.com/EDDYCJY/go-gin-example/middleware  =&gt; ~/go-application/go-gin-example/middleware
		github.com/EDDYCJY/go-gin-example/models 	  =&gt; ~/go-application/go-gin-example/models
		github.com/EDDYCJY/go-gin-example/routers 	  =&gt; ~/go-application/go-gin-example/routers
)
</code></pre><p>可能你会不理解为什么要特意跑来加 <code>replace</code> 配置项，首先你要看到我们使用的是完整的外部模块引用路径（<code>github.com/EDDYCJY/go-gin-example/xxx</code>），而这个模块还没推送到远程，是没有办法下载下来的，因此需要用 <code>replace</code> 将其指定读取本地的模块路径，这样子就可以解决本地模块读取的问题。</p>
<p><strong>注：后续每新增一个本地应用目录，你都需要主动去 go.mod 文件里新增一条 replace（我不会提醒你），如果你漏了，那么编译时会出现报错，找不到那个模块。</strong></p>
<h3 id="初始项目数据库">初始项目数据库<a href="#初始项目数据库" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>新建 <code>blog</code> 数据库，编码为<code>utf8_general_ci</code>，在 <code>blog</code> 数据库下，新建以下表</p>
<p><strong>1、 标签表</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">blog_tag</span><span class="o">`</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
  <span class="o">`</span><span class="n">name</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="s1">&#39;&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;标签名称&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">created_on</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">DEFAULT</span> <span class="s1">&#39;0&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;创建时间&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">created_by</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="s1">&#39;&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;创建人&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">modified_on</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">DEFAULT</span> <span class="s1">&#39;0&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;修改时间&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">modified_by</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="s1">&#39;&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;修改人&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">deleted_on</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">DEFAULT</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="k">state</span><span class="o">`</span> <span class="n">tinyint</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">DEFAULT</span> <span class="s1">&#39;1&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;状态 0为禁用、1为启用&#39;</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span> <span class="k">COMMENT</span><span class="o">=</span><span class="s1">&#39;文章标签管理&#39;</span><span class="p">;</span>
</code></pre></div><p><strong>2、 文章表</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">blog_article</span><span class="o">`</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
  <span class="o">`</span><span class="n">tag_id</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">DEFAULT</span> <span class="s1">&#39;0&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;标签ID&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">title</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="s1">&#39;&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;文章标题&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="k">desc</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="s1">&#39;&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;简述&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">content</span><span class="o">`</span> <span class="nb">text</span><span class="p">,</span>
  <span class="o">`</span><span class="n">created_on</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">created_by</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="s1">&#39;&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;创建人&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">modified_on</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">DEFAULT</span> <span class="s1">&#39;0&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;修改时间&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">modified_by</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="s1">&#39;&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;修改人&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">deleted_on</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">DEFAULT</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="k">state</span><span class="o">`</span> <span class="n">tinyint</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">DEFAULT</span> <span class="s1">&#39;1&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;状态 0为禁用1为启用&#39;</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span> <span class="k">COMMENT</span><span class="o">=</span><span class="s1">&#39;文章管理&#39;</span><span class="p">;</span>
</code></pre></div><p><strong>3、 认证表</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">blog_auth</span><span class="o">`</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
  <span class="o">`</span><span class="n">username</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="s1">&#39;&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;账号&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">password</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="s1">&#39;&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;密码&#39;</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">`</span><span class="n">blog</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">blog_auth</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">,</span> <span class="o">`</span><span class="n">username</span><span class="o">`</span><span class="p">,</span> <span class="o">`</span><span class="n">password</span><span class="o">`</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;test123456&#39;</span><span class="p">);</span>

</code></pre></div><h2 id="编写项目配置包">编写项目配置包<a href="#编写项目配置包" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>在 <code>go-gin-example</code> 应用目录下，拉取 <code>go-ini/ini</code> 的依赖包，如下：</p>
<pre><code>$ go get -u github.com/go-ini/ini
go: finding github.com/go-ini/ini v1.48.0
go: downloading github.com/go-ini/ini v1.48.0
go: extracting github.com/go-ini/ini v1.48.0
</code></pre><p>接下来我们需要编写基础的应用配置文件，在 <code>go-gin-example</code> 的<code>conf</code>目录下新建<code>app.ini</code>文件，写入内容：</p>
<div class="highlight"><pre class="chroma"><code class="language-ini" data-lang="ini"><span class="c1">#debug or release</span>
<span class="na">RUN_MODE</span> <span class="o">=</span> <span class="s">debug</span>

<span class="k">[app]</span>
<span class="na">PAGE_SIZE</span> <span class="o">=</span> <span class="s">10</span>
<span class="na">JWT_SECRET</span> <span class="o">=</span> <span class="s">23347$040412</span>

<span class="k">[server]</span>
<span class="na">HTTP_PORT</span> <span class="o">=</span> <span class="s">8000</span>
<span class="na">READ_TIMEOUT</span> <span class="o">=</span> <span class="s">60</span>
<span class="na">WRITE_TIMEOUT</span> <span class="o">=</span> <span class="s">60</span>

<span class="k">[database]</span>
<span class="na">TYPE</span> <span class="o">=</span> <span class="s">mysql</span>
<span class="na">USER</span> <span class="o">=</span> <span class="s">数据库账号</span>
<span class="na">PASSWORD</span> <span class="o">=</span> <span class="s">数据库密码</span>
<span class="c1">#127.0.0.1:3306</span>
<span class="na">HOST</span> <span class="o">=</span> <span class="s">数据库IP:数据库端口号</span>
<span class="na">NAME</span> <span class="o">=</span> <span class="s">blog</span>
<span class="na">TABLE_PREFIX</span> <span class="o">=</span> <span class="s">blog_</span>
</code></pre></div><p>建立调用配置的<code>setting</code>模块，在<code>go-gin-example</code>的<code>pkg</code>目录下新建<code>setting</code>目录（注意新增 replace 配置），新建 <code>setting.go</code> 文件，写入内容：</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">setting</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;log&#34;</span>
	<span class="s">&#34;time&#34;</span>

	<span class="s">&#34;github.com/go-ini/ini&#34;</span>
<span class="p">)</span>

<span class="kd">var</span> <span class="p">(</span>
	<span class="nx">Cfg</span> <span class="o">*</span><span class="nx">ini</span><span class="p">.</span><span class="nx">File</span>

	<span class="nx">RunMode</span> <span class="kt">string</span>

	<span class="nx">HTTPPort</span> <span class="kt">int</span>
	<span class="nx">ReadTimeout</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span>
	<span class="nx">WriteTimeout</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span>

	<span class="nx">PageSize</span> <span class="kt">int</span>
	<span class="nx">JwtSecret</span> <span class="kt">string</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">err</span> <span class="kt">error</span>
	<span class="nx">Cfg</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">ini</span><span class="p">.</span><span class="nf">Load</span><span class="p">(</span><span class="s">&#34;conf/app.ini&#34;</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;Fail to parse &#39;conf/app.ini&#39;: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="nf">LoadBase</span><span class="p">()</span>
	<span class="nf">LoadServer</span><span class="p">()</span>
	<span class="nf">LoadApp</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">LoadBase</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">RunMode</span> <span class="p">=</span> <span class="nx">Cfg</span><span class="p">.</span><span class="nf">Section</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">).</span><span class="nf">Key</span><span class="p">(</span><span class="s">&#34;RUN_MODE&#34;</span><span class="p">).</span><span class="nf">MustString</span><span class="p">(</span><span class="s">&#34;debug&#34;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">LoadServer</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">sec</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">Cfg</span><span class="p">.</span><span class="nf">GetSection</span><span class="p">(</span><span class="s">&#34;server&#34;</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;Fail to get section &#39;server&#39;: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="nx">HTTPPort</span> <span class="p">=</span> <span class="nx">sec</span><span class="p">.</span><span class="nf">Key</span><span class="p">(</span><span class="s">&#34;HTTP_PORT&#34;</span><span class="p">).</span><span class="nf">MustInt</span><span class="p">(</span><span class="mi">8000</span><span class="p">)</span>
	<span class="nx">ReadTimeout</span> <span class="p">=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Duration</span><span class="p">(</span><span class="nx">sec</span><span class="p">.</span><span class="nf">Key</span><span class="p">(</span><span class="s">&#34;READ_TIMEOUT&#34;</span><span class="p">).</span><span class="nf">MustInt</span><span class="p">(</span><span class="mi">60</span><span class="p">))</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span>
	<span class="nx">WriteTimeout</span> <span class="p">=</span>  <span class="nx">time</span><span class="p">.</span><span class="nf">Duration</span><span class="p">(</span><span class="nx">sec</span><span class="p">.</span><span class="nf">Key</span><span class="p">(</span><span class="s">&#34;WRITE_TIMEOUT&#34;</span><span class="p">).</span><span class="nf">MustInt</span><span class="p">(</span><span class="mi">60</span><span class="p">))</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">LoadApp</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">sec</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">Cfg</span><span class="p">.</span><span class="nf">GetSection</span><span class="p">(</span><span class="s">&#34;app&#34;</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;Fail to get section &#39;app&#39;: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="nx">JwtSecret</span> <span class="p">=</span> <span class="nx">sec</span><span class="p">.</span><span class="nf">Key</span><span class="p">(</span><span class="s">&#34;JWT_SECRET&#34;</span><span class="p">).</span><span class="nf">MustString</span><span class="p">(</span><span class="s">&#34;!@)*#)!@U#@*!@!)&#34;</span><span class="p">)</span>
	<span class="nx">PageSize</span> <span class="p">=</span> <span class="nx">sec</span><span class="p">.</span><span class="nf">Key</span><span class="p">(</span><span class="s">&#34;PAGE_SIZE&#34;</span><span class="p">).</span><span class="nf">MustInt</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><p>当前的目录结构：</p>
<pre><code>go-gin-example
├── conf
│   └── app.ini
├── go.mod
├── go.sum
├── middleware
├── models
├── pkg
│   └── setting.go
├── routers
└── runtime
</code></pre><h2 id="编写-api-错误码包">编写 API 错误码包<a href="#编写-api-错误码包" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>建立错误码的<code>e</code>模块，在<code>go-gin-example</code>的<code>pkg</code>目录下新建<code>e</code>目录（注意新增 replace 配置），新建<code>code.go</code>和<code>msg.go</code>文件，写入内容：</p>
<p><strong>1、 code.go：</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">e</span>

<span class="kd">const</span> <span class="p">(</span>
	<span class="nx">SUCCESS</span> <span class="p">=</span> <span class="mi">200</span>
	<span class="nx">ERROR</span> <span class="p">=</span> <span class="mi">500</span>
	<span class="nx">INVALID_PARAMS</span> <span class="p">=</span> <span class="mi">400</span>

	<span class="nx">ERROR_EXIST_TAG</span> <span class="p">=</span> <span class="mi">10001</span>
	<span class="nx">ERROR_NOT_EXIST_TAG</span> <span class="p">=</span> <span class="mi">10002</span>
	<span class="nx">ERROR_NOT_EXIST_ARTICLE</span> <span class="p">=</span> <span class="mi">10003</span>

	<span class="nx">ERROR_AUTH_CHECK_TOKEN_FAIL</span> <span class="p">=</span> <span class="mi">20001</span>
	<span class="nx">ERROR_AUTH_CHECK_TOKEN_TIMEOUT</span> <span class="p">=</span> <span class="mi">20002</span>
	<span class="nx">ERROR_AUTH_TOKEN</span> <span class="p">=</span> <span class="mi">20003</span>
	<span class="nx">ERROR_AUTH</span> <span class="p">=</span> <span class="mi">20004</span>
<span class="p">)</span>
</code></pre></div><p><strong>2、 msg.go：</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">e</span>

<span class="kd">var</span> <span class="nx">MsgFlags</span> <span class="p">=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">string</span> <span class="p">{</span>
	<span class="nx">SUCCESS</span> <span class="p">:</span> <span class="s">&#34;ok&#34;</span><span class="p">,</span>
	<span class="nx">ERROR</span> <span class="p">:</span> <span class="s">&#34;fail&#34;</span><span class="p">,</span>
	<span class="nx">INVALID_PARAMS</span> <span class="p">:</span> <span class="s">&#34;请求参数错误&#34;</span><span class="p">,</span>
	<span class="nx">ERROR_EXIST_TAG</span> <span class="p">:</span> <span class="s">&#34;已存在该标签名称&#34;</span><span class="p">,</span>
	<span class="nx">ERROR_NOT_EXIST_TAG</span> <span class="p">:</span> <span class="s">&#34;该标签不存在&#34;</span><span class="p">,</span>
	<span class="nx">ERROR_NOT_EXIST_ARTICLE</span> <span class="p">:</span> <span class="s">&#34;该文章不存在&#34;</span><span class="p">,</span>
	<span class="nx">ERROR_AUTH_CHECK_TOKEN_FAIL</span> <span class="p">:</span> <span class="s">&#34;Token鉴权失败&#34;</span><span class="p">,</span>
	<span class="nx">ERROR_AUTH_CHECK_TOKEN_TIMEOUT</span> <span class="p">:</span> <span class="s">&#34;Token已超时&#34;</span><span class="p">,</span>
	<span class="nx">ERROR_AUTH_TOKEN</span> <span class="p">:</span> <span class="s">&#34;Token生成失败&#34;</span><span class="p">,</span>
	<span class="nx">ERROR_AUTH</span> <span class="p">:</span> <span class="s">&#34;Token错误&#34;</span><span class="p">,</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">GetMsg</span><span class="p">(</span><span class="nx">code</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
	<span class="nx">msg</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">MsgFlags</span><span class="p">[</span><span class="nx">code</span><span class="p">]</span>
	<span class="k">if</span> <span class="nx">ok</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">msg</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="nx">MsgFlags</span><span class="p">[</span><span class="nx">ERROR</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div><h2 id="编写工具包">编写工具包<a href="#编写工具包" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>在<code>go-gin-example</code>的<code>pkg</code>目录下新建<code>util</code>目录（注意新增 replace 配置），并拉取<code>com</code>的依赖包，如下：</p>
<pre><code>$ go get -u github.com/unknwon/com
</code></pre><h3 id="编写分页页码的获取方法">编写分页页码的获取方法<a href="#编写分页页码的获取方法" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>在<code>util</code>目录下新建<code>pagination.go</code>，写入内容：</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">util</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;github.com/gin-gonic/gin&#34;</span>
	<span class="s">&#34;github.com/unknwon/com&#34;</span>

	<span class="s">&#34;github.com/EDDYCJY/go-gin-example/pkg/setting&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">GetPage</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
	<span class="nx">result</span> <span class="o">:=</span> <span class="mi">0</span>
	<span class="nx">page</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">com</span><span class="p">.</span><span class="nf">StrTo</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nf">Query</span><span class="p">(</span><span class="s">&#34;page&#34;</span><span class="p">)).</span><span class="nf">Int</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">page</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="nx">result</span> <span class="p">=</span> <span class="p">(</span><span class="nx">page</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nx">setting</span><span class="p">.</span><span class="nx">PageSize</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">result</span>
<span class="p">}</span>
</code></pre></div><h2 id="编写-models-init">编写 models init<a href="#编写-models-init" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>拉取<code>gorm</code>的依赖包，如下：</p>
<pre><code>$ go get -u github.com/jinzhu/gorm
</code></pre><p>拉取<code>mysql</code>驱动的依赖包，如下：</p>
<pre><code>$ go get -u github.com/go-sql-driver/mysql
</code></pre><p>完成后，在<code>go-gin-example</code>的<code>models</code>目录下新建<code>models.go</code>，用于<code>models</code>的初始化使用</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">models</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;log&#34;</span>
	<span class="s">&#34;fmt&#34;</span>

	<span class="s">&#34;github.com/jinzhu/gorm&#34;</span>
	<span class="nx">_</span> <span class="s">&#34;github.com/jinzhu/gorm/dialects/mysql&#34;</span>

	<span class="s">&#34;github.com/EDDYCJY/go-gin-example/pkg/setting&#34;</span>
<span class="p">)</span>

<span class="kd">var</span> <span class="nx">db</span> <span class="o">*</span><span class="nx">gorm</span><span class="p">.</span><span class="nx">DB</span>

<span class="kd">type</span> <span class="nx">Model</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">ID</span> <span class="kt">int</span> <span class="s">`gorm:&#34;primary_key&#34; json:&#34;id&#34;`</span>
	<span class="nx">CreatedOn</span> <span class="kt">int</span> <span class="s">`json:&#34;created_on&#34;`</span>
	<span class="nx">ModifiedOn</span> <span class="kt">int</span> <span class="s">`json:&#34;modified_on&#34;`</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="p">(</span>
		<span class="nx">err</span> <span class="kt">error</span>
		<span class="nx">dbType</span><span class="p">,</span> <span class="nx">dbName</span><span class="p">,</span> <span class="nx">user</span><span class="p">,</span> <span class="nx">password</span><span class="p">,</span> <span class="nx">host</span><span class="p">,</span> <span class="nx">tablePrefix</span> <span class="kt">string</span>
	<span class="p">)</span>

	<span class="nx">sec</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">setting</span><span class="p">.</span><span class="nx">Cfg</span><span class="p">.</span><span class="nf">GetSection</span><span class="p">(</span><span class="s">&#34;database&#34;</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&#34;Fail to get section &#39;database&#39;: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="nx">dbType</span> <span class="p">=</span> <span class="nx">sec</span><span class="p">.</span><span class="nf">Key</span><span class="p">(</span><span class="s">&#34;TYPE&#34;</span><span class="p">).</span><span class="nf">String</span><span class="p">()</span>
	<span class="nx">dbName</span> <span class="p">=</span> <span class="nx">sec</span><span class="p">.</span><span class="nf">Key</span><span class="p">(</span><span class="s">&#34;NAME&#34;</span><span class="p">).</span><span class="nf">String</span><span class="p">()</span>
	<span class="nx">user</span> <span class="p">=</span> <span class="nx">sec</span><span class="p">.</span><span class="nf">Key</span><span class="p">(</span><span class="s">&#34;USER&#34;</span><span class="p">).</span><span class="nf">String</span><span class="p">()</span>
	<span class="nx">password</span> <span class="p">=</span> <span class="nx">sec</span><span class="p">.</span><span class="nf">Key</span><span class="p">(</span><span class="s">&#34;PASSWORD&#34;</span><span class="p">).</span><span class="nf">String</span><span class="p">()</span>
	<span class="nx">host</span> <span class="p">=</span> <span class="nx">sec</span><span class="p">.</span><span class="nf">Key</span><span class="p">(</span><span class="s">&#34;HOST&#34;</span><span class="p">).</span><span class="nf">String</span><span class="p">()</span>
	<span class="nx">tablePrefix</span> <span class="p">=</span> <span class="nx">sec</span><span class="p">.</span><span class="nf">Key</span><span class="p">(</span><span class="s">&#34;TABLE_PREFIX&#34;</span><span class="p">).</span><span class="nf">String</span><span class="p">()</span>

	<span class="nx">db</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">gorm</span><span class="p">.</span><span class="nf">Open</span><span class="p">(</span><span class="nx">dbType</span><span class="p">,</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;%s:%s@tcp(%s)/%s?charset=utf8&amp;parseTime=True&amp;loc=Local&#34;</span><span class="p">,</span>
		<span class="nx">user</span><span class="p">,</span>
		<span class="nx">password</span><span class="p">,</span>
		<span class="nx">host</span><span class="p">,</span>
		<span class="nx">dbName</span><span class="p">))</span>

	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="nx">gorm</span><span class="p">.</span><span class="nx">DefaultTableNameHandler</span> <span class="p">=</span> <span class="kd">func</span> <span class="p">(</span><span class="nx">db</span> <span class="o">*</span><span class="nx">gorm</span><span class="p">.</span><span class="nx">DB</span><span class="p">,</span> <span class="nx">defaultTableName</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span>  <span class="p">{</span>
	    <span class="k">return</span> <span class="nx">tablePrefix</span> <span class="o">+</span> <span class="nx">defaultTableName</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="nx">db</span><span class="p">.</span><span class="nf">SingularTable</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
	<span class="nx">db</span><span class="p">.</span><span class="nf">LogMode</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
	<span class="nx">db</span><span class="p">.</span><span class="nf">DB</span><span class="p">().</span><span class="nf">SetMaxIdleConns</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
	<span class="nx">db</span><span class="p">.</span><span class="nf">DB</span><span class="p">().</span><span class="nf">SetMaxOpenConns</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">CloseDB</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">defer</span> <span class="nx">db</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div><h2 id="编写项目启动路由文件">编写项目启动、路由文件<a href="#编写项目启动路由文件" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>最基础的准备工作完成啦，让我们开始编写 Demo 吧！</p>
<h3 id="编写-demo">编写 Demo<a href="#编写-demo" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>在<code>go-gin-example</code>下建立<code>main.go</code>作为启动文件（也就是<code>main</code>包），我们先写个<strong>Demo</strong>，帮助大家理解，写入文件内容：</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&#34;fmt&#34;</span>
    <span class="s">&#34;net/http&#34;</span>

    <span class="s">&#34;github.com/gin-gonic/gin&#34;</span>

    <span class="s">&#34;github.com/EDDYCJY/go-gin-example/pkg/setting&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">router</span> <span class="o">:=</span> <span class="nx">gin</span><span class="p">.</span><span class="nf">Default</span><span class="p">()</span>
    <span class="nx">router</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/test&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">c</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
			<span class="s">&#34;message&#34;</span><span class="p">:</span> <span class="s">&#34;test&#34;</span><span class="p">,</span>
		<span class="p">})</span>
	<span class="p">})</span>

	<span class="nx">s</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Server</span><span class="p">{</span>
		<span class="nx">Addr</span><span class="p">:</span>           <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;:%d&#34;</span><span class="p">,</span> <span class="nx">setting</span><span class="p">.</span><span class="nx">HTTPPort</span><span class="p">),</span>
		<span class="nx">Handler</span><span class="p">:</span>        <span class="nx">router</span><span class="p">,</span>
		<span class="nx">ReadTimeout</span><span class="p">:</span>    <span class="nx">setting</span><span class="p">.</span><span class="nx">ReadTimeout</span><span class="p">,</span>
		<span class="nx">WriteTimeout</span><span class="p">:</span>   <span class="nx">setting</span><span class="p">.</span><span class="nx">WriteTimeout</span><span class="p">,</span>
		<span class="nx">MaxHeaderBytes</span><span class="p">:</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">20</span><span class="p">,</span>
	<span class="p">}</span>

	<span class="nx">s</span><span class="p">.</span><span class="nf">ListenAndServe</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div><p>执行<code>go run main.go</code>，查看命令行是否显示</p>
<pre><code>[GIN-debug] [WARNING] Creating an Engine instance with the Logger and Recovery middleware already attached.

[GIN-debug] [WARNING] Running in &quot;debug&quot; mode. Switch to &quot;release&quot; mode in production.
 - using env:	export GIN_MODE=release
 - using code:	gin.SetMode(gin.ReleaseMode)

[GIN-debug] GET    /test                     --&gt; main.main.func1 (3 handlers)
</code></pre><p>在本机执行<code>curl 127.0.0.1:8000/test</code>，检查是否返回<code>{&quot;message&quot;:&quot;test&quot;}</code>。</p>
<h3 id="知识点">知识点<a href="#知识点" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p><strong>那么，我们来延伸一下 Demo 所涉及的知识点！</strong></p>
<h5 id="标准库">标准库<a href="#标准库" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h5>
<ul>
<li><a href="https://golang.org/pkg/fmt/">fmt</a>：实现了类似 C 语言 printf 和 scanf 的格式化 I/O。格式化动作（&lsquo;verb&rsquo;）源自 C 语言但更简单</li>
<li><a href="https://golang.org/pkg/net/http/">net/http</a>：提供了 HTTP 客户端和服务端的实现</li>
</ul>
<h5 id="gin"><strong>Gin</strong><a href="#gin" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h5>
<ul>
<li><a href="https://gowalker.org/github.com/gin-gonic/gin#Default">gin.Default()</a>：返回 Gin 的<code>type Engine struct{...}</code>，里面包含<code>RouterGroup</code>，相当于创建一个路由<code>Handlers</code>，可以后期绑定各类的路由规则和函数、中间件等</li>
<li><a href="https://gowalker.org/github.com/gin-gonic/gin#IRoutes">router.GET(&hellip;){&hellip;}</a>：创建不同的 HTTP 方法绑定到<code>Handlers</code>中，也支持 POST、PUT、DELETE、PATCH、OPTIONS、HEAD 等常用的 Restful 方法</li>
<li><a href="https://gowalker.org/github.com/gin-gonic/gin#H">gin.H{&hellip;}</a>：就是一个<code>map[string]interface{}</code></li>
<li><a href="https://gowalker.org/github.com/gin-gonic/gin#Context">gin.Context</a>：<code>Context</code>是<code>gin</code>中的上下文，它允许我们在中间件之间传递变量、管理流、验证 JSON 请求、响应 JSON 请求等，在<code>gin</code>中包含大量<code>Context</code>的方法，例如我们常用的<code>DefaultQuery</code>、<code>Query</code>、<code>DefaultPostForm</code>、<code>PostForm</code>等等</li>
</ul>
<h5 id="httpserver-和-listenandserve">&amp;http.Server 和 ListenAndServe？<a href="#httpserver-和-listenandserve" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h5>
<p>1、http.Server：</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Server</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Addr</span>    <span class="kt">string</span>
    <span class="nx">Handler</span> <span class="nx">Handler</span>
    <span class="nx">TLSConfig</span> <span class="o">*</span><span class="nx">tls</span><span class="p">.</span><span class="nx">Config</span>
    <span class="nx">ReadTimeout</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span>
    <span class="nx">ReadHeaderTimeout</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span>
    <span class="nx">WriteTimeout</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span>
    <span class="nx">IdleTimeout</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span>
    <span class="nx">MaxHeaderBytes</span> <span class="kt">int</span>
    <span class="nx">ConnState</span> <span class="kd">func</span><span class="p">(</span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">,</span> <span class="nx">ConnState</span><span class="p">)</span>
    <span class="nx">ErrorLog</span> <span class="o">*</span><span class="nx">log</span><span class="p">.</span><span class="nx">Logger</span>
<span class="p">}</span>
</code></pre></div><ul>
<li>Addr：监听的 TCP 地址，格式为<code>:8000</code></li>
<li>Handler：http 句柄，实质为<code>ServeHTTP</code>，用于处理程序响应 HTTP 请求</li>
<li>TLSConfig：安全传输层协议（TLS）的配置</li>
<li>ReadTimeout：允许读取的最大时间</li>
<li>ReadHeaderTimeout：允许读取请求头的最大时间</li>
<li>WriteTimeout：允许写入的最大时间</li>
<li>IdleTimeout：等待的最大时间</li>
<li>MaxHeaderBytes：请求头的最大字节数</li>
<li>ConnState：指定一个可选的回调函数，当客户端连接发生变化时调用</li>
<li>ErrorLog：指定一个可选的日志记录器，用于接收程序的意外行为和底层系统错误；如果未设置或为<code>nil</code>则默认以日志包的标准日志记录器完成（也就是在控制台输出）</li>
</ul>
<p>2、 ListenAndServe：</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">srv</span> <span class="o">*</span><span class="nx">Server</span><span class="p">)</span> <span class="nf">ListenAndServe</span><span class="p">()</span> <span class="kt">error</span> <span class="p">{</span>
    <span class="nx">addr</span> <span class="o">:=</span> <span class="nx">srv</span><span class="p">.</span><span class="nx">Addr</span>
    <span class="k">if</span> <span class="nx">addr</span> <span class="o">==</span> <span class="s">&#34;&#34;</span> <span class="p">{</span>
        <span class="nx">addr</span> <span class="p">=</span> <span class="s">&#34;:http&#34;</span>
    <span class="p">}</span>
    <span class="nx">ln</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">net</span><span class="p">.</span><span class="nf">Listen</span><span class="p">(</span><span class="s">&#34;tcp&#34;</span><span class="p">,</span> <span class="nx">addr</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">err</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">srv</span><span class="p">.</span><span class="nf">Serve</span><span class="p">(</span><span class="nx">tcpKeepAliveListener</span><span class="p">{</span><span class="nx">ln</span><span class="p">.(</span><span class="o">*</span><span class="nx">net</span><span class="p">.</span><span class="nx">TCPListener</span><span class="p">)})</span>
<span class="p">}</span>
</code></pre></div><p>开始监听服务，监听 TCP 网络地址，Addr 和调用应用程序处理连接上的请求。</p>
<p>我们在源码中看到<code>Addr</code>是调用我们在<code>&amp;http.Server</code>中设置的参数，因此我们在设置时要用<code>&amp;</code>，我们要改变参数的值，因为我们<code>ListenAndServe</code>和其他一些方法需要用到<code>&amp;http.Server</code>中的参数，他们是相互影响的。</p>
<p>3、 <code>http.ListenAndServe</code>和 <a href="https://segmentfault.com/a/1190000013297625#articleHeader5">连载一</a> 的<code>r.Run()</code>有区别吗？</p>
<p>我们看看<code>r.Run</code>的实现：</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">engine</span> <span class="o">*</span><span class="nx">Engine</span><span class="p">)</span> <span class="nf">Run</span><span class="p">(</span><span class="nx">addr</span> <span class="o">...</span><span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">defer</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span> <span class="nf">debugPrintError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">}()</span>

    <span class="nx">address</span> <span class="o">:=</span> <span class="nf">resolveAddress</span><span class="p">(</span><span class="nx">addr</span><span class="p">)</span>
    <span class="nf">debugPrint</span><span class="p">(</span><span class="s">&#34;Listening and serving HTTP on %s\n&#34;</span><span class="p">,</span> <span class="nx">address</span><span class="p">)</span>
    <span class="nx">err</span> <span class="p">=</span> <span class="nx">http</span><span class="p">.</span><span class="nf">ListenAndServe</span><span class="p">(</span><span class="nx">address</span><span class="p">,</span> <span class="nx">engine</span><span class="p">)</span>
    <span class="k">return</span>
<span class="p">}</span>
</code></pre></div><p>通过分析源码，得知<strong>本质上没有区别</strong>，同时也得知了启动<code>gin</code>时的监听 debug 信息在这里输出。</p>
<p>4、 为什么 Demo 里会有<code>WARNING</code>？</p>
<p>首先我们可以看下<code>Default()</code>的实现</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// Default returns an Engine instance with the Logger and Recovery middleware already attached.
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">Default</span><span class="p">()</span> <span class="o">*</span><span class="nx">Engine</span> <span class="p">{</span>
	<span class="nf">debugPrintWARNINGDefault</span><span class="p">()</span>
	<span class="nx">engine</span> <span class="o">:=</span> <span class="nf">New</span><span class="p">()</span>
	<span class="nx">engine</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="nf">Logger</span><span class="p">(),</span> <span class="nf">Recovery</span><span class="p">())</span>
	<span class="k">return</span> <span class="nx">engine</span>
<span class="p">}</span>
</code></pre></div><p>大家可以看到默认情况下，已经附加了日志、恢复中间件的引擎实例。并且在开头调用了<code>debugPrintWARNINGDefault()</code>，而它的实现就是输出该行日志</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">debugPrintWARNINGDefault</span><span class="p">()</span> <span class="p">{</span>
	<span class="nf">debugPrint</span><span class="p">(</span><span class="s">`[WARNING] Creating an Engine instance with the Logger and Recovery middleware already attached.
</span><span class="s">`</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><p>而另外一个<code>Running in &quot;debug&quot; mode. Switch to &quot;release&quot; mode in production.</code>，是运行模式原因，并不难理解，已在配置文件的管控下 :-)，运维人员随时就可以修改它的配置。</p>
<p>5、 Demo 的<code>router.GET</code>等路由规则可以不写在<code>main</code>包中吗？</p>
<p>我们发现<code>router.GET</code>等路由规则，在 Demo 中被编写在了<code>main</code>包中，感觉很奇怪，我们去抽离这部分逻辑！</p>
<p>在<code>go-gin-example</code>下<code>routers</code>目录新建<code>router.go</code>文件，写入内容：</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">routers</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&#34;github.com/gin-gonic/gin&#34;</span>

    <span class="s">&#34;github.com/EDDYCJY/go-gin-example/pkg/setting&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">InitRouter</span><span class="p">()</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Engine</span> <span class="p">{</span>
    <span class="nx">r</span> <span class="o">:=</span> <span class="nx">gin</span><span class="p">.</span><span class="nf">New</span><span class="p">()</span>

    <span class="nx">r</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="nx">gin</span><span class="p">.</span><span class="nf">Logger</span><span class="p">())</span>

    <span class="nx">r</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="nx">gin</span><span class="p">.</span><span class="nf">Recovery</span><span class="p">())</span>

    <span class="nx">gin</span><span class="p">.</span><span class="nf">SetMode</span><span class="p">(</span><span class="nx">setting</span><span class="p">.</span><span class="nx">RunMode</span><span class="p">)</span>

    <span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/test&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">c</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
            <span class="s">&#34;message&#34;</span><span class="p">:</span> <span class="s">&#34;test&#34;</span><span class="p">,</span>
        <span class="p">})</span>
    <span class="p">})</span>

    <span class="k">return</span> <span class="nx">r</span>
<span class="p">}</span>
</code></pre></div><p>修改<code>main.go</code>的文件内容：</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;fmt&#34;</span>
	<span class="s">&#34;net/http&#34;</span>

	<span class="s">&#34;github.com/EDDYCJY/go-gin-example/routers&#34;</span>
	<span class="s">&#34;github.com/EDDYCJY/go-gin-example/pkg/setting&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">router</span> <span class="o">:=</span> <span class="nx">routers</span><span class="p">.</span><span class="nf">InitRouter</span><span class="p">()</span>

	<span class="nx">s</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Server</span><span class="p">{</span>
		<span class="nx">Addr</span><span class="p">:</span>           <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;:%d&#34;</span><span class="p">,</span> <span class="nx">setting</span><span class="p">.</span><span class="nx">HTTPPort</span><span class="p">),</span>
		<span class="nx">Handler</span><span class="p">:</span>        <span class="nx">router</span><span class="p">,</span>
		<span class="nx">ReadTimeout</span><span class="p">:</span>    <span class="nx">setting</span><span class="p">.</span><span class="nx">ReadTimeout</span><span class="p">,</span>
		<span class="nx">WriteTimeout</span><span class="p">:</span>   <span class="nx">setting</span><span class="p">.</span><span class="nx">WriteTimeout</span><span class="p">,</span>
		<span class="nx">MaxHeaderBytes</span><span class="p">:</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">20</span><span class="p">,</span>
	<span class="p">}</span>

	<span class="nx">s</span><span class="p">.</span><span class="nf">ListenAndServe</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div><p>当前目录结构：</p>
<pre><code>go-gin-example/
├── conf
│   └── app.ini
├── main.go
├── middleware
├── models
│   └── models.go
├── pkg
│   ├── e
│   │   ├── code.go
│   │   └── msg.go
│   ├── setting
│   │   └── setting.go
│   └── util
│       └── pagination.go
├── routers
│   └── router.go
├── runtime
</code></pre><p>重启服务，执行 <code>curl 127.0.0.1:8000/test</code>查看是否正确返回。</p>
<p>下一节，我们将以我们的 Demo 为起点进行修改，开始编码！</p>
<h2 id="参考">参考<a href="#参考" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<h3 id="本系列示例代码">本系列示例代码<a href="#本系列示例代码" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<ul>
<li><a href="https://github.com/EDDYCJY/go-gin-example">go-gin-example</a></li>
</ul>
<h2 id="关于">关于<a href="#关于" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<h3 id="修改记录">修改记录<a href="#修改记录" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<ul>
<li>第一版：2018 年 02 月 16 日发布文章</li>
<li>第二版：2019 年 10 月 01 日修改文章</li>
</ul>
<h2 id="heading">？<a href="#heading" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>如果有任何疑问或错误，欢迎在 <a href="https://github.com/EDDYCJY/blog">issues</a> 进行提问或给予修正意见，如果喜欢或对你有所帮助，欢迎 Star，对作者是一种鼓励和推进。</p>
<h3 id="我的公众号">我的公众号<a href="#我的公众号" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p><img src="https://image.eddycjy.com/8d0b0c3a11e74efd5fdfd7910257e70b.jpg" alt="image"></p>

			</div>
			<hr class="post-end">
			<footer class="post-info">
				<p>
					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://eddycjy.com/tags/go">go</a></span><span class="tag"><a href="https://eddycjy.com/tags/gin">gin</a></span>
				</p>
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>1252 Words</p>
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2018-02-11 20:00 &#43;0800</p>
			</footer>
		</article>
		<aside id="toc" class="show-toc">
			<div class="toc-title">Table of Contents</div>
			<nav id="TableOfContents">
  <ul>
    <li><a href="#思考">思考</a></li>
    <li><a href="#本文目标">本文目标</a></li>
    <li><a href="#介绍和初始化项目">介绍和初始化项目</a>
      <ul>
        <li><a href="#初始化项目目录">初始化项目目录</a></li>
        <li><a href="#添加-go-modules-replace">添加 Go Modules Replace</a></li>
        <li><a href="#初始项目数据库">初始项目数据库</a></li>
      </ul>
    </li>
    <li><a href="#编写项目配置包">编写项目配置包</a></li>
    <li><a href="#编写-api-错误码包">编写 API 错误码包</a></li>
    <li><a href="#编写工具包">编写工具包</a>
      <ul>
        <li><a href="#编写分页页码的获取方法">编写分页页码的获取方法</a></li>
      </ul>
    </li>
    <li><a href="#编写-models-init">编写 models init</a></li>
    <li><a href="#编写项目启动路由文件">编写项目启动、路由文件</a>
      <ul>
        <li><a href="#编写-demo">编写 Demo</a></li>
        <li><a href="#知识点">知识点</a></li>
      </ul>
    </li>
    <li><a href="#参考">参考</a>
      <ul>
        <li><a href="#本系列示例代码">本系列示例代码</a></li>
      </ul>
    </li>
    <li><a href="#关于">关于</a>
      <ul>
        <li><a href="#修改记录">修改记录</a></li>
      </ul>
    </li>
    <li><a href="#heading">？</a>
      <ul>
        <li><a href="#我的公众号">我的公众号</a></li>
      </ul>
    </li>
  </ul>
</nav>
		</aside>
		<div class="post-nav thin">
			<a class="next-post" href="https://eddycjy.com/posts/go/gin/2018-02-12-api-02/">
				<span class="post-nav-label"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>&nbsp;Newer</span><br><span>「连载三」Gin搭建Blog API&#39;s （二）</span>
			</a>
			<a class="prev-post" href="https://eddycjy.com/posts/go/gin/2018-02-10-install/">
				<span class="post-nav-label">Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><br><span>「连载一」Go 介绍与环境安装</span>
			</a>
		</div>
		<div id="comments" class="thin">
						<script src="https://utteranc.es/client.js"
							repo="eddycjy/blog"
							issue-term="pathname"
							theme="github-light"
							crossorigin="anonymous"
							async>
			</script>
		</div>
	</main>

	<footer id="site-footer" class="section-inner thin animated fadeIn faster">
		<p>&copy; 2020 <a href="https://eddycjy.com">煎鱼</a> &#183; <a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></p>
		<p>
			Made with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> &#183; Theme <a href="https://github.com/Track3/hermit" target="_blank" rel="noopener">Hermit</a> &#183; <a href="https://eddycjy.com/post/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a>
		</p>
	</footer>


	<script src="https://eddycjy.com/js/main.min.784417f5847151f848c339cf0acb13a06cbb648b1483435a28ed4556c4ead69b.js"></script>

</body>

</html>

<!DOCTYPE html>
<html lang="zh-hans">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<meta name="theme-color" content="#494f5c">
	<meta name="msapplication-TileColor" content="#494f5c">
<meta itemprop="name" content="log æ ‡å‡†åº“">
<meta itemprop="description" content="æ—¥å¿— è¾“å‡º 2018/09/28 20:03:08 EDDYCJY Blog... æ„æˆ [æ—¥æœŸ]&lt;ç©ºæ ¼&gt;[æ—¶åˆ†ç§’]&lt;ç©ºæ ¼&gt;[å†…å®¹]&lt;\n&gt;
æºç å‰–æ Logger type Logger struct { mu sync.Mutex prefix string flag int out io.Writer buf []byte }  muï¼šäº’æ–¥é”ï¼Œç”¨äºç¡®ä¿åŸå­çš„å†™å…¥ prefixï¼šæ¯è¡Œéœ€å†™å…¥çš„æ—¥å¿—å‰ç¼€å†…å®¹ flagï¼šè®¾ç½®æ—¥å¿—è¾…åŠ©ä¿¡æ¯ï¼ˆæ—¶é—´ã€æ–‡ä»¶åã€è¡Œå·ï¼‰çš„å†™å…¥ã€‚å¯é€‰å¦‚ä¸‹æ ‡è¯†ä½ï¼š  const ( Ldate = 1 &lt;&lt; iota // value: 1 Ltime // value: 2 Lmicroseconds // value: 4 Llongfile // value: 8 Lshortfile // value: 16 LUTC // value: 32 LstdFlags = Ldate | Ltime // value: 3 )  Ldateï¼šå½“åœ°æ—¶åŒºçš„æ ¼å¼åŒ–æ—¥æœŸï¼š2009/01/23 Ltimeï¼šå½“åœ°æ—¶åŒºçš„æ ¼å¼åŒ–æ—¶é—´ï¼š01:23:23 Lmicrosecondsï¼šåœ¨ Ltime çš„åŸºç¡€ä¸Šï¼Œå¢åŠ å¾®ç§’çš„æ—¶é—´æ•°å€¼æ˜¾ç¤º Llongfileï¼šå®Œæ•´çš„æ–‡ä»¶åå’Œè¡Œå·ï¼š/a/b/c/d.">
<meta itemprop="datePublished" content="2018-09-28T12:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2018-09-28T12:00:00&#43;00:00" />
<meta itemprop="wordCount" content="607">



<meta itemprop="keywords" content="go,æºç åˆ†æ," /><meta property="og:title" content="log æ ‡å‡†åº“" />
<meta property="og:description" content="æ—¥å¿— è¾“å‡º 2018/09/28 20:03:08 EDDYCJY Blog... æ„æˆ [æ—¥æœŸ]&lt;ç©ºæ ¼&gt;[æ—¶åˆ†ç§’]&lt;ç©ºæ ¼&gt;[å†…å®¹]&lt;\n&gt;
æºç å‰–æ Logger type Logger struct { mu sync.Mutex prefix string flag int out io.Writer buf []byte }  muï¼šäº’æ–¥é”ï¼Œç”¨äºç¡®ä¿åŸå­çš„å†™å…¥ prefixï¼šæ¯è¡Œéœ€å†™å…¥çš„æ—¥å¿—å‰ç¼€å†…å®¹ flagï¼šè®¾ç½®æ—¥å¿—è¾…åŠ©ä¿¡æ¯ï¼ˆæ—¶é—´ã€æ–‡ä»¶åã€è¡Œå·ï¼‰çš„å†™å…¥ã€‚å¯é€‰å¦‚ä¸‹æ ‡è¯†ä½ï¼š  const ( Ldate = 1 &lt;&lt; iota // value: 1 Ltime // value: 2 Lmicroseconds // value: 4 Llongfile // value: 8 Lshortfile // value: 16 LUTC // value: 32 LstdFlags = Ldate | Ltime // value: 3 )  Ldateï¼šå½“åœ°æ—¶åŒºçš„æ ¼å¼åŒ–æ—¥æœŸï¼š2009/01/23 Ltimeï¼šå½“åœ°æ—¶åŒºçš„æ ¼å¼åŒ–æ—¶é—´ï¼š01:23:23 Lmicrosecondsï¼šåœ¨ Ltime çš„åŸºç¡€ä¸Šï¼Œå¢åŠ å¾®ç§’çš„æ—¶é—´æ•°å€¼æ˜¾ç¤º Llongfileï¼šå®Œæ•´çš„æ–‡ä»¶åå’Œè¡Œå·ï¼š/a/b/c/d." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://eddycjy.com/posts/go/pkg/2018-09-28-log/" />
<meta property="article:published_time" content="2018-09-28T12:00:00+00:00" />
<meta property="article:modified_time" content="2018-09-28T12:00:00+00:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="log æ ‡å‡†åº“"/>
<meta name="twitter:description" content="æ—¥å¿— è¾“å‡º 2018/09/28 20:03:08 EDDYCJY Blog... æ„æˆ [æ—¥æœŸ]&lt;ç©ºæ ¼&gt;[æ—¶åˆ†ç§’]&lt;ç©ºæ ¼&gt;[å†…å®¹]&lt;\n&gt;
æºç å‰–æ Logger type Logger struct { mu sync.Mutex prefix string flag int out io.Writer buf []byte }  muï¼šäº’æ–¥é”ï¼Œç”¨äºç¡®ä¿åŸå­çš„å†™å…¥ prefixï¼šæ¯è¡Œéœ€å†™å…¥çš„æ—¥å¿—å‰ç¼€å†…å®¹ flagï¼šè®¾ç½®æ—¥å¿—è¾…åŠ©ä¿¡æ¯ï¼ˆæ—¶é—´ã€æ–‡ä»¶åã€è¡Œå·ï¼‰çš„å†™å…¥ã€‚å¯é€‰å¦‚ä¸‹æ ‡è¯†ä½ï¼š  const ( Ldate = 1 &lt;&lt; iota // value: 1 Ltime // value: 2 Lmicroseconds // value: 4 Llongfile // value: 8 Lshortfile // value: 16 LUTC // value: 32 LstdFlags = Ldate | Ltime // value: 3 )  Ldateï¼šå½“åœ°æ—¶åŒºçš„æ ¼å¼åŒ–æ—¥æœŸï¼š2009/01/23 Ltimeï¼šå½“åœ°æ—¶åŒºçš„æ ¼å¼åŒ–æ—¶é—´ï¼š01:23:23 Lmicrosecondsï¼šåœ¨ Ltime çš„åŸºç¡€ä¸Šï¼Œå¢åŠ å¾®ç§’çš„æ—¶é—´æ•°å€¼æ˜¾ç¤º Llongfileï¼šå®Œæ•´çš„æ–‡ä»¶åå’Œè¡Œå·ï¼š/a/b/c/d."/>

	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
	<link rel="shortcut icon" href="/favicon.ico">

	<title>log æ ‡å‡†åº“</title>
	<link rel="stylesheet" href="https://eddycjy.com/css/style.min.43ade9343bda1e3f53fcb45dc776c310b369f2a93c03dee67c82401987989309.css">
	
</head>

<body id="page">
	
	<header id="site-header" class="animated slideInUp faster">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					<a href="https://eddycjy.com">ç…é±¼</a>
				</div>
				<nav class="site-nav hide-in-mobile">
					<a href="https://eddycjy.com/posts/">Posts</a>
					<a href="https://eddycjy.com/tags/">Tags</a>
					<a href="https://eddycjy.com/about/">About</a>
				</nav>
			</div>
			<div class="hdr-right hdr-icons">
				<button id="toc-btn" class="hdr-btn desktop-only-ib" title="Table of Contents"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-list"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3" y2="6"></line><line x1="3" y1="12" x2="3" y2="12"></line><line x1="3" y1="18" x2="3" y2="18"></line></svg></button><span class="hdr-social hide-in-mobile"><a href="https://github.com/eddycjy" target="_blank" rel="noopener me" title="Github"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a></span><button id="menu-btn" class="hdr-btn" title="Menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast">
		<ul>
			<li><a href="https://eddycjy.com/posts/">Posts</a></li>
			<li><a href="https://eddycjy.com/tags/">Tags</a></li>
			<li><a href="https://eddycjy.com/about/">About</a></li>
		</ul>
	</div>


	<main class="site-main section-inner animated fadeIn faster">
		<article class="thin">
			<header class="post-header">
				<div class="post-meta"><span>Sep 28, 2018</span></div>
				<h1>log æ ‡å‡†åº“</h1>
			</header>
			<div class="content">
				<h2 id="æ—¥å¿—">æ—¥å¿—<a href="#æ—¥å¿—" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<h3 id="è¾“å‡º">è¾“å‡º<a href="#è¾“å‡º" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<pre><code>2018/09/28 20:03:08 EDDYCJY Blog...
</code></pre><h3 id="æ„æˆ">æ„æˆ<a href="#æ„æˆ" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>[æ—¥æœŸ]&lt;ç©ºæ ¼&gt;[æ—¶åˆ†ç§’]&lt;ç©ºæ ¼&gt;[å†…å®¹]&lt;\n&gt;</p>
<h2 id="æºç å‰–æ">æºç å‰–æ<a href="#æºç å‰–æ" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<h3 id="logger">Logger<a href="#logger" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<pre><code>type Logger struct {
	mu     sync.Mutex 
	prefix string
	flag   int
	out    io.Writer
	buf    []byte
}
</code></pre><ol>
<li>muï¼šäº’æ–¥é”ï¼Œç”¨äºç¡®ä¿åŸå­çš„å†™å…¥</li>
<li>prefixï¼šæ¯è¡Œéœ€å†™å…¥çš„æ—¥å¿—å‰ç¼€å†…å®¹</li>
<li>flagï¼šè®¾ç½®æ—¥å¿—è¾…åŠ©ä¿¡æ¯ï¼ˆæ—¶é—´ã€æ–‡ä»¶åã€è¡Œå·ï¼‰çš„å†™å…¥ã€‚å¯é€‰å¦‚ä¸‹æ ‡è¯†ä½ï¼š</li>
</ol>
<pre><code>const (
	Ldate         = 1 &lt;&lt; iota       // value: 1
	Ltime                           // value: 2
	Lmicroseconds                   // value: 4
	Llongfile                       // value: 8
	Lshortfile                      // value: 16
	LUTC                            // value: 32
	LstdFlags     = Ldate | Ltime   // value: 3
)
</code></pre><ul>
<li>Ldateï¼šå½“åœ°æ—¶åŒºçš„æ ¼å¼åŒ–æ—¥æœŸï¼š2009/01/23</li>
<li>Ltimeï¼šå½“åœ°æ—¶åŒºçš„æ ¼å¼åŒ–æ—¶é—´ï¼š01:23:23</li>
<li>Lmicrosecondsï¼šåœ¨ Ltime çš„åŸºç¡€ä¸Šï¼Œå¢åŠ å¾®ç§’çš„æ—¶é—´æ•°å€¼æ˜¾ç¤º</li>
<li>Llongfileï¼šå®Œæ•´çš„æ–‡ä»¶åå’Œè¡Œå·ï¼š/a/b/c/d.go:23</li>
<li>Lshortfileï¼šå½“å‰æ–‡ä»¶åå’Œè¡Œå·ï¼šd.goï¼š23ï¼Œä¼šè¦†ç›– Llongfile æ ‡è¯†</li>
<li>LUTCï¼šå¦‚æœè®¾ç½® Ldate æˆ– Ltimeï¼Œä¸”è®¾ç½® LUTCï¼Œåˆ™ä¼˜å…ˆä½¿ç”¨ UTC æ—¶åŒºè€Œä¸æ˜¯æœ¬åœ°æ—¶åŒº</li>
<li>LstdFlagsï¼šLogger çš„é»˜è®¤åˆå§‹å€¼ï¼ˆLdate å’Œ Ltimeï¼‰</li>
</ul>
<ol start="4">
<li>outï¼šio.Writer</li>
<li>bufï¼šç”¨äºå­˜å‚¨å°†è¦å†™å…¥çš„æ—¥å¿—å†…å®¹</li>
</ol>
<h3 id="new">New<a href="#new" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<pre><code>func New(out io.Writer, prefix string, flag int) *Logger {
	return &amp;Logger{out: out, prefix: prefix, flag: flag}
}

var std = New(os.Stderr, &quot;&quot;, LstdFlags)
</code></pre><p>New æ–¹æ³•ç”¨äºåˆå§‹åŒ– Loggerï¼Œæ¥å—ä¸‰ä¸ªåˆå§‹å‚æ•°ï¼Œå¯ä»¥å®šåˆ¶åŒ–è€Œåœ¨ log åŒ…å†…é»˜è®¤ä¼šåˆå§‹ä¸€ä¸ª stdï¼Œå®ƒæŒ‡å‘æ ‡å‡†è¾“å…¥æµã€‚è€Œé»˜è®¤çš„æ ‡å‡†è¾“å‡ºã€æ ‡å‡†é”™è¯¯å°±æ˜¯æ˜¾ç¤ºå™¨ï¼ˆè¾“å‡ºåˆ°å±å¹•ä¸Šï¼‰ï¼Œæ ‡å‡†è¾“å…¥å°±æ˜¯é”®ç›˜ã€‚è¾…åŠ©çš„æ—¶é—´ä¿¡æ¯é»˜è®¤ä¸º <code>Ldate | Ltime</code>ï¼Œä¹Ÿå°±æ˜¯ <code>2009/01/23 01:23:23</code></p>
<pre><code>// os
var (
	Stdin  = NewFile(uintptr(syscall.Stdin), &quot;/dev/stdin&quot;)
	Stdout = NewFile(uintptr(syscall.Stdout), &quot;/dev/stdout&quot;)
	Stderr = NewFile(uintptr(syscall.Stderr), &quot;/dev/stderr&quot;)
)
</code></pre><ul>
<li>Stdinï¼šæ ‡å‡†è¾“å…¥</li>
<li>Stdoutï¼šæ ‡å‡†è¾“å‡º</li>
<li>Stderrï¼šæ ‡å‡†é”™è¯¯</li>
</ul>
<h3 id="getter">Getter<a href="#getter" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<ul>
<li>Flags</li>
<li>Prefix</li>
</ul>
<h3 id="setter">Setter<a href="#setter" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<ul>
<li>SetFlags</li>
<li>SetPrefix</li>
<li>SetOutput</li>
</ul>
<h3 id="print-fatal-panic">Print*, Fatal*, Panic*<a href="#print-fatal-panic" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<pre><code>func Print(v ...interface{}) {
	std.Output(2, fmt.Sprint(v...))
}

func Printf(format string, v ...interface{}) {
	std.Output(2, fmt.Sprintf(format, v...))
}

func Println(v ...interface{}) {
	std.Output(2, fmt.Sprintln(v...))
}

func Fatal(v ...interface{}) {
	std.Output(2, fmt.Sprint(v...))
	os.Exit(1)
}

func Panic(v ...interface{}) {
	s := fmt.Sprint(v...)
	std.Output(2, s)
	panic(s)
}

...
</code></pre><p>è¿™ä¸€éƒ¨åˆ†ä»‹ç»æœ€å¸¸ç”¨çš„æ—¥å¿—å†™å…¥æ–¹æ³•ï¼Œä»æºç å¯å¾—çŸ¥ <code>Xrintln</code>ã€<code>Xrintf</code> å‡½æ•° <strong>æ¢è¡Œ</strong>ã€<strong>å¯å˜å‚æ•°</strong>éƒ½æ˜¯é€šè¿‡ <code>fmt</code> æ ‡å‡†åº“çš„æ–¹æ³•å»å®ç°çš„</p>
<p><code>Fatal</code> å’Œ <code>Panic</code> æ˜¯é€šè¿‡ <code>os.Exit(1)</code>ã€<code>panic(s)</code> é›†æˆå®ç°çš„ã€‚è€Œå…·ä½“çš„ç»„è£…é€»è¾‘æ˜¯é€šè¿‡ <code>Output</code> æ–¹æ³•å®ç°çš„</p>
<h4 id="loggeroutput">Logger.Output<a href="#loggeroutput" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<pre><code>func (l *Logger) Output(calldepth int, s string) error {
	now := time.Now() // get this early.
	var file string
	var line int
	l.mu.Lock()
	defer l.mu.Unlock()
	if l.flag&amp;(Lshortfile|Llongfile) != 0 {
		// Release lock while getting caller info - it's expensive.
		l.mu.Unlock()
		var ok bool
		_, file, line, ok = runtime.Caller(calldepth)
		if !ok {
			file = &quot;???&quot;
			line = 0
		}
		l.mu.Lock()
	}
	l.buf = l.buf[:0]
	l.formatHeader(&amp;l.buf, now, file, line)
	l.buf = append(l.buf, s...)
	if len(s) == 0 || s[len(s)-1] != '\n' {
		l.buf = append(l.buf, '\n')
	}
	_, err := l.out.Write(l.buf)
	return err
}
</code></pre><p>Output æ–¹æ³•ï¼Œç®€å•æ¥è®²å°±æ˜¯å°†å†™å…¥çš„æ—¥å¿—äº‹ä»¶ä¿¡æ¯ç»„è£…å¹¶è¾“å‡ºï¼Œå®ƒä¼šæ ¹æ® flag æ ‡è¯†ä½çš„ä¸åŒæ¥ä½¿ç”¨ <code>runtime.Caller</code> å»è·å–å½“å‰ goroutine æ‰€æ‰§è¡Œçš„å‡½æ•°æ–‡ä»¶ã€è¡Œå·ç­‰è°ƒç”¨ä¿¡æ¯ï¼ˆlog æ ‡å‡†åº“ä¸­é»˜è®¤æ·±åº¦ä¸º 2ï¼‰ã€‚å¦å¤–å¦‚æœç»“å°¾ä¸æ˜¯æ¢è¡Œç¬¦ <code>\n</code>ï¼Œå°†è‡ªåŠ¨è¡¥å…¨ä¸€ä¸ªæ¢è¡Œ</p>
<h4 id="loggerformatheader">Logger.formatHeader<a href="#loggerformatheader" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<pre><code>func (l *Logger) formatHeader(buf *[]byte, t time.Time, file string, line int) {
	*buf = append(*buf, l.prefix...)
	if l.flag&amp;(Ldate|Ltime|Lmicroseconds) != 0 {
		if l.flag&amp;LUTC != 0 {
			t = t.UTC()
		}
		if l.flag&amp;Ldate != 0 {
			year, month, day := t.Date()
			itoa(buf, year, 4)
			*buf = append(*buf, '/')
			itoa(buf, int(month), 2)
			*buf = append(*buf, '/')
			itoa(buf, day, 2)
			*buf = append(*buf, ' ')
		}
		if l.flag&amp;(Ltime|Lmicroseconds) != 0 {
			hour, min, sec := t.Clock()
			itoa(buf, hour, 2)
			*buf = append(*buf, ':')
			itoa(buf, min, 2)
			*buf = append(*buf, ':')
			itoa(buf, sec, 2)
			if l.flag&amp;Lmicroseconds != 0 {
				*buf = append(*buf, '.')
				itoa(buf, t.Nanosecond()/1e3, 6)
			}
			*buf = append(*buf, ' ')
		}
	}
	if l.flag&amp;(Lshortfile|Llongfile) != 0 {
		if l.flag&amp;Lshortfile != 0 {
			short := file
			for i := len(file) - 1; i &gt; 0; i-- {
				if file[i] == '/' {
					short = file[i+1:]
					break
				}
			}
			file = short
		}
		*buf = append(*buf, file...)
		*buf = append(*buf, ':')
		itoa(buf, line, -1)
		*buf = append(*buf, &quot;: &quot;...)
	}
}
</code></pre><p>è¯¥æ–¹æ³•ä¸»è¦æ˜¯ç”¨äºæ ¼å¼åŒ–æ—¥å¿—å¤´ï¼ˆå‰ç¼€ï¼‰ï¼Œæ ¹æ®å…¥å‚ä¸åŒçš„æ ‡è¯†ä½ï¼Œæ·»åŠ åˆ†éš”ç¬¦å’Œå¯¹åº”çš„å€¼åˆ°æ—¥å¿—ä¿¡æ¯ä¸­ã€‚æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p>
<p>ï¼ˆ1ï¼‰å¦‚æœä¸æ˜¯ç©ºå€¼ï¼Œåˆ™å°† prefix å†™å…¥ buf</p>
<p>ï¼ˆ2ï¼‰å¦‚æœè®¾ç½® <code>Ldate</code>ã€<code>Ltime</code>ã€<code>Lmicroseconds</code>ï¼Œåˆ™å¯¹åº”å°†æ—¥æœŸå’Œæ—¶é—´å†™å…¥ buf</p>
<p>ï¼ˆ3ï¼‰å¦‚æœè®¾ç½® <code>Lshortfile</code>ã€<code>Llongfile</code>ï¼Œåˆ™å¯¹åº”å°†æ–‡ä»¶å’Œè¡Œå·ä¿¡æ¯å†™å…¥ buf</p>
<h4 id="loggeritoa">Logger.itoa<a href="#loggeritoa" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<pre><code>func itoa(buf *[]byte, i int, wid int) {
	// Assemble decimal in reverse order.
	var b [20]byte
	bp := len(b) - 1
	for i &gt;= 10 || wid &gt; 1 {
		wid--
		q := i / 10
		b[bp] = byte('0' + i - q*10)
		bp--
		i = q
	}
	// i &lt; 10
	b[bp] = byte('0' + i)
	*buf = append(*buf, b[bp:]...)
}
</code></pre><p>è¯¥æ–¹æ³•ä¸»è¦ç”¨äºå°†æ•´æ•°è½¬æ¢ä¸ºå®šé•¿çš„åè¿›åˆ¶ ASCIIï¼ŒåŒæ—¶ç»™å‡ºè´Ÿæ•°å®½åº¦é¿å…å·¦ä¾§è¡¥ 0ã€‚å¦å¤–ä¼šä»¥ç›¸åçš„é¡ºåºç»„åˆåè¿›åˆ¶</p>
<h3 id="å¦‚ä½•å®šåˆ¶åŒ–-logger">å¦‚ä½•å®šåˆ¶åŒ– Logger<a href="#å¦‚ä½•å®šåˆ¶åŒ–-logger" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>åœ¨æ ‡å‡†åº“å†…ï¼Œå¯é€šè¿‡å…¶å¼€æ”¾çš„ New æ–¹æ³•æ¥å®ç°å„ç§å„æ ·çš„è‡ªå®šä¹‰ Logger ç»„ä»¶ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆä¹Ÿå¯ä»¥ç›´æ¥ <code>log.Print*</code> ç­‰æ–¹æ³•å‘¢ï¼Ÿ</p>
<pre><code>func New(out io.Writer, prefix string, flag int) *Logger
</code></pre><p>å…¶å®æ˜¯åœ¨æ ‡å‡†åº“å†…ï¼Œå¦‚æœä½ åˆšåˆšç»†å¿ƒçš„çœ‹äº†å‰é¢çš„å°èŠ‚ï¼Œä¸éš¾å‘ç°å…¶é»˜è®¤å®ç°äº†ä¸€ä¸ª Logger ç»„ä»¶</p>
<pre><code>var std = New(os.Stderr, &quot;&quot;, LstdFlags)
</code></pre><p>è¿™ä¹Ÿæ˜¯ä¸€ä¸ªå°å°çš„ç²¾å¦™ä¹‹å¤„ â­•ï¸</p>
<h2 id="æ€»ç»“">æ€»ç»“<a href="#æ€»ç»“" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>é€šè¿‡æŸ¥é˜… log æ ‡å‡†åº“çš„æºç ï¼Œå¯å¾—çŸ¥æœ€ç®€å•çš„ä¸€ä¸ªæ—¥å¿—åŒ…åº”è¯¥å¦‚ä½•ç¼–å†™ã€‚å¦å¤– log åŒ…æ˜¯åœ¨æ‰€æœ‰æ¶‰åŠåˆ° Logger çš„åœ°æ–¹éƒ½å¯¹ <code>sync.Mutex</code> è¿›è¡Œæ“ä½œï¼ˆä»¥æ­¤è§£å†³åŸå­é—®é¢˜ï¼‰ï¼Œå…¶ä½™é€»è¾‘å‡ä¸ºç»„è£…æ—¥å¿—ä¿¡æ¯å’Œè½¬æ¢æ•°å€¼æ ¼å¼ï¼Œè¯¥åŒ…è¾ƒä¸ºç»å…¸ï¼Œå¯ä»¥å¤šè¯»å‡ é ğŸ˜„</p>
<h2 id="é—®é¢˜">é—®é¢˜<a href="#é—®é¢˜" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>ä¸ºä»€ä¹ˆåœ¨è°ƒç”¨ <code>runtime.Caller</code> å‰è¦å…ˆè§£é”ï¼Œåå†åŠ é”å‘¢?</p>

			</div>
			<hr class="post-end">
			<footer class="post-info">
				<p>
					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://eddycjy.com/tags/go">go</a></span><span class="tag"><a href="https://eddycjy.com/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90">æºç åˆ†æ</a></span>
				</p>
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>607 Words</p>
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2018-09-28 20:00 &#43;0800</p>
			</footer>
		</article>
		<aside id="toc" class="show-toc">
			<div class="toc-title">Table of Contents</div>
			<nav id="TableOfContents">
  <ul>
    <li><a href="#æ—¥å¿—">æ—¥å¿—</a>
      <ul>
        <li><a href="#è¾“å‡º">è¾“å‡º</a></li>
        <li><a href="#æ„æˆ">æ„æˆ</a></li>
      </ul>
    </li>
    <li><a href="#æºç å‰–æ">æºç å‰–æ</a>
      <ul>
        <li><a href="#logger">Logger</a></li>
        <li><a href="#new">New</a></li>
        <li><a href="#getter">Getter</a></li>
        <li><a href="#setter">Setter</a></li>
        <li><a href="#print-fatal-panic">Print*, Fatal*, Panic*</a></li>
        <li><a href="#å¦‚ä½•å®šåˆ¶åŒ–-logger">å¦‚ä½•å®šåˆ¶åŒ– Logger</a></li>
      </ul>
    </li>
    <li><a href="#æ€»ç»“">æ€»ç»“</a></li>
    <li><a href="#é—®é¢˜">é—®é¢˜</a></li>
  </ul>
</nav>
		</aside>
		<div class="post-nav thin">
			<a class="next-post" href="https://eddycjy.com/posts/go/grpc/2018-10-07-grpc-tls/">
				<span class="post-nav-label"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>&nbsp;Newer</span><br><span>ã€Œè¿è½½å››ã€TLS è¯ä¹¦è®¤è¯</span>
			</a>
			<a class="prev-post" href="https://eddycjy.com/posts/go/grpc/2018-09-24-stream-client-server/">
				<span class="post-nav-label">Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><br><span>ã€Œè¿è½½ä¸‰ã€gRPC Streaming, Client and Server</span>
			</a>
		</div>
		<div id="comments" class="thin">
						<script src="https://utteranc.es/client.js"
							repo="eddycjy/blog"
							issue-term="pathname"
							theme="github-light"
							crossorigin="anonymous"
							async>
			</script>
		</div>
	</main>

	<footer id="site-footer" class="section-inner thin animated fadeIn faster">
		<p>&copy; 2020 <a href="https://eddycjy.com">ç…é±¼</a> &#183; <a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></p>
		<p>
			Made with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> &#183; Theme <a href="https://github.com/Track3/hermit" target="_blank" rel="noopener">Hermit</a> &#183; <a href="https://eddycjy.com/post/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a>
		</p>
	</footer>


	<script src="https://eddycjy.com/js/main.min.784417f5847151f848c339cf0acb13a06cbb648b1483435a28ed4556c4ead69b.js"></script>

</body>

</html>
